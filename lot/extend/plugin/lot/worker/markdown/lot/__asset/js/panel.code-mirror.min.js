!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror"),require("../xml/xml"),require("../meta")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../xml/xml","../meta"],e):e(CodeMirror)}(function(e){"use strict";e.defineMode("markdown",function(t,r){function o(r){if(e.findModeByName){var n=e.findModeByName(r);n&&(r=n.mime||n.mimes[0])}var i=e.getMode(t,r);return"null"==i.name?null:i}function m(e,t,r){return t.f=t.inline=r,r(e,t)}function g(e,t,r){return t.f=t.block=r,r(e,t)}function v(e){return!e||!/\S/.test(e.string)}function y(e){return e.linkTitle=!1,e.em=!1,e.strong=!1,e.strikethrough=!1,e.quote=0,e.indentedCode=!1,i&&e.f==w&&(e.f=S,e.block=b),e.trailingSpace=0,e.trailingSpaceNewLine=!1,e.prevLine=e.thisLine,e.thisLine=null,null}function b(t,n){var i=t.sol(),l=n.list!==!1,h=n.indentedCode;n.indentedCode=!1,l&&(n.indentationDiff>=0?(n.indentationDiff<4&&(n.indentation-=n.indentationDiff),n.list=null):n.indentation>0?n.list=null:n.list=!1);var g=null;if(n.indentationDiff>=4)return t.skipToEnd(),h||v(n.prevLine)?(n.indentation-=4,n.indentedCode=!0,a.code):null;if(t.eatSpace())return null;if((g=t.match(f))&&g[1].length<=6)return n.header=g[1].length,r.highlightFormatting&&(n.formatting="header"),n.f=n.inline,_(n);if(!(v(n.prevLine)||n.quote||l||h)&&(g=t.match(d)))return n.header="="==g[0].charAt(0)?1:2,r.highlightFormatting&&(n.formatting="header"),n.f=n.inline,_(n);if(t.eat(">"))return n.quote=i?1:n.quote+1,r.highlightFormatting&&(n.formatting="quote"),t.eatSpace(),_(n);if("["===t.peek())return m(t,n,N);if(t.match(s,!0))return n.hr=!0,a.hr;if(g=t.match(u)){var y=g[1]?"ol":"ul";for(n.indentation=t.column()+t.current().length,n.list=!0;n.listStack&&t.column()<n.listStack[n.listStack.length-1];)n.listStack.pop();return n.listStack.push(n.indentation),r.taskLists&&t.match(c,!1)&&(n.taskList=!0),n.f=n.inline,r.highlightFormatting&&(n.formatting=["list","list-"+y]),_(n)}return r.fencedCodeBlocks&&(g=t.match(p,!0))?(n.fencedChars=g[1],n.localMode=o(g[2]),n.localMode&&(n.localState=e.startState(n.localMode)),n.f=n.block=x,r.highlightFormatting&&(n.formatting="code-block"),n.code=-1,_(n)):m(t,n,n.inline)}function w(t,r){var o=n.token(t,r.htmlState);if(!i){var a=e.innerMode(n,r.htmlState);("xml"==a.mode.name&&null===a.state.tagStart&&!a.state.context&&a.state.tokenize.isInText||r.md_inside&&t.current().indexOf(">")>-1)&&(r.f=S,r.block=b,r.htmlState=null)}return o}function x(e,t){return t.fencedChars&&e.match(t.fencedChars,!1)?(t.localMode=t.localState=null,t.f=t.block=k,null):t.localMode?t.localMode.token(e,t.localState):(e.skipToEnd(),a.code)}function k(e,t){e.match(t.fencedChars),t.block=b,t.f=S,t.fencedChars=null,r.highlightFormatting&&(t.formatting="code-block"),t.code=1;var n=_(t);return t.code=0,n}function _(e){var t=[];if(e.formatting){t.push(a.formatting),"string"==typeof e.formatting&&(e.formatting=[e.formatting]);for(var n=0;n<e.formatting.length;n++)t.push(a.formatting+"-"+e.formatting[n]),"header"===e.formatting[n]&&t.push(a.formatting+"-"+e.formatting[n]+"-"+e.header),"quote"===e.formatting[n]&&(!r.maxBlockquoteDepth||r.maxBlockquoteDepth>=e.quote?t.push(a.formatting+"-"+e.formatting[n]+"-"+e.quote):t.push("error"))}if(e.taskOpen)return t.push("meta"),t.length?t.join(" "):null;if(e.taskClosed)return t.push("property"),t.length?t.join(" "):null;if(e.linkHref?t.push(a.linkHref,"url"):(e.strong&&t.push(a.strong),e.em&&t.push(a.em),e.strikethrough&&t.push(a.strikethrough),e.linkText&&t.push(a.linkText),e.code&&t.push(a.code),e.image&&t.push(a.image),e.imageAltText&&t.push(a.imageAltText,"link"),e.imageMarker&&t.push(a.imageMarker)),e.header&&t.push(a.header,a.header+"-"+e.header),e.quote&&(t.push(a.quote),!r.maxBlockquoteDepth||r.maxBlockquoteDepth>=e.quote?t.push(a.quote+"-"+e.quote):t.push(a.quote+"-"+r.maxBlockquoteDepth)),e.list!==!1){var i=(e.listStack.length-1)%3;i?1===i?t.push(a.list2):t.push(a.list3):t.push(a.list1)}return e.trailingSpaceNewLine?t.push("trailing-space-new-line"):e.trailingSpace&&t.push("trailing-space-"+(e.trailingSpace%2?"a":"b")),t.length?t.join(" "):null}function C(e,t){return e.match(h,!0)?_(t):void 0}function S(t,i){var o=i.text(t,i);if("undefined"!=typeof o)return o;if(i.list)return i.list=null,_(i);if(i.taskList){var l="x"!==t.match(c,!0)[1];return l?i.taskOpen=!0:i.taskClosed=!0,r.highlightFormatting&&(i.formatting="task"),i.taskList=!1,_(i)}if(i.taskOpen=!1,i.taskClosed=!1,i.header&&t.match(/^#+$/,!0))return r.highlightFormatting&&(i.formatting="header"),_(i);var s=t.sol(),u=t.next();if(i.linkTitle){i.linkTitle=!1;var f=u;"("===u&&(f=")"),f=(f+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1");var d="^\\s*(?:[^"+f+"\\\\]+|\\\\\\\\|\\\\.)"+f;if(t.match(new RegExp(d),!0))return a.linkHref}if("`"===u){var h=i.formatting;r.highlightFormatting&&(i.formatting="code"),t.eatWhile("`");var p=t.current().length;if(0==i.code)return i.code=p,_(i);if(p==i.code){var m=_(i);return i.code=0,m}return i.formatting=h,_(i)}if(i.code)return _(i);if("\\"===u&&(t.next(),r.highlightFormatting)){var v=_(i),y=a.formatting+"-escape";return v?v+" "+y:y}if("!"===u&&t.match(/\[[^\]]*\] ?(?:\(|\[)/,!1))return i.imageMarker=!0,i.image=!0,r.highlightFormatting&&(i.formatting="image"),_(i);if("["===u&&i.imageMarker&&t.match(/[^\]]*\](\(.*?\)| ?\[.*?\])/,!1))return i.imageMarker=!1,i.imageAltText=!0,r.highlightFormatting&&(i.formatting="image"),_(i);if("]"===u&&i.imageAltText){r.highlightFormatting&&(i.formatting="image");var v=_(i);return i.imageAltText=!1,i.image=!1,i.inline=i.f=L,v}if("["===u&&t.match(/[^\]]*\](\(.*\)| ?\[.*?\])/,!1)&&!i.image)return i.linkText=!0,r.highlightFormatting&&(i.formatting="link"),_(i);if("]"===u&&i.linkText&&t.match(/\(.*?\)| ?\[.*?\]/,!1)){r.highlightFormatting&&(i.formatting="link");var v=_(i);return i.linkText=!1,i.inline=i.f=L,v}if("<"===u&&t.match(/^(https?|ftps?):\/\/(?:[^\\>]|\\.)+>/,!1)){i.f=i.inline=M,r.highlightFormatting&&(i.formatting="link");var v=_(i);return v?v+=" ":v="",v+a.linkInline}if("<"===u&&t.match(/^[^> \\]+@(?:[^\\>]|\\.)+>/,!1)){i.f=i.inline=M,r.highlightFormatting&&(i.formatting="link");var v=_(i);return v?v+=" ":v="",v+a.linkEmail}if("<"===u&&t.match(/^(!--|[a-z]+(?:\s+[a-z_:.\-]+(?:\s*=\s*[^ >]+)?)*\s*>)/i,!1)){var b=t.string.indexOf(">",t.pos);if(-1!=b){var x=t.string.substring(t.start,b);/markdown\s*=\s*('|"){0,1}1('|"){0,1}/.test(x)&&(i.md_inside=!0)}return t.backUp(1),i.htmlState=e.startState(n),g(t,i,w)}if("<"===u&&t.match(/^\/\w*?>/))return i.md_inside=!1,"tag";var k=!1;if(!r.underscoresBreakWords&&"_"===u&&"_"!==t.peek()&&t.match(/(\w)/,!1)){var C=t.pos-2;if(C>=0){var S=t.string.charAt(C);"_"!==S&&S.match(/(\w)/,!1)&&(k=!0)}}if("*"===u||"_"===u&&!k)if(s&&" "===t.peek());else{if(i.strong===u&&t.eat(u)){r.highlightFormatting&&(i.formatting="strong");var m=_(i);return i.strong=!1,m}if(!i.strong&&t.eat(u))return i.strong=u,r.highlightFormatting&&(i.formatting="strong"),_(i);if(i.em===u){r.highlightFormatting&&(i.formatting="em");var m=_(i);return i.em=!1,m}if(!i.em)return i.em=u,r.highlightFormatting&&(i.formatting="em"),_(i)}else if(" "===u&&(t.eat("*")||t.eat("_"))){if(" "===t.peek())return _(i);t.backUp(1)}if(r.strikethrough)if("~"===u&&t.eatWhile(u)){if(i.strikethrough){r.highlightFormatting&&(i.formatting="strikethrough");var m=_(i);return i.strikethrough=!1,m}if(t.match(/^[^\s]/,!1))return i.strikethrough=!0,r.highlightFormatting&&(i.formatting="strikethrough"),_(i)}else if(" "===u&&t.match(/^~~/,!0)){if(" "===t.peek())return _(i);t.backUp(2)}return" "===u&&(t.match(/ +$/,!1)?i.trailingSpace++:i.trailingSpace&&(i.trailingSpaceNewLine=!0)),_(i)}function M(e,t){var n=e.next();if(">"===n){t.f=t.inline=S,r.highlightFormatting&&(t.formatting="link");var i=_(t);return i?i+=" ":i="",i+a.linkInline}return e.match(/^[^>]+/,!0),a.linkInline}function L(e,t){if(e.eatSpace())return null;var n=e.next();return"("===n||"["===n?(t.f=t.inline=O("("===n?")":"]",0),r.highlightFormatting&&(t.formatting="link-string"),t.linkHref=!0,_(t)):"error"}function O(e){return function(t,n){var i=t.next();if(i===e){n.f=n.inline=S,r.highlightFormatting&&(n.formatting="link-string");var o=_(n);return n.linkHref=!1,o}return t.match(T[e]),n.linkHref=!0,_(n)}}function N(e,t){return e.match(/^([^\]\\]|\\.)*\]:/,!1)?(t.f=A,e.next(),r.highlightFormatting&&(t.formatting="link"),t.linkText=!0,_(t)):m(e,t,S)}function A(e,t){if(e.match(/^\]:/,!0)){t.f=t.inline=P,r.highlightFormatting&&(t.formatting="link");var n=_(t);return t.linkText=!1,n}return e.match(/^([^\]\\]|\\.)+/,!0),a.linkText}function P(e,t){return e.eatSpace()?null:(e.match(/^[^\s]+/,!0),void 0===e.peek()?t.linkTitle=!0:e.match(/^(?:\s+(?:"(?:[^"\\]|\\\\|\\.)+"|'(?:[^'\\]|\\\\|\\.)+'|\((?:[^)\\]|\\\\|\\.)+\)))?/,!0),t.f=t.inline=S,a.linkHref+" url")}var n=e.getMode(t,"text/html"),i="null"==n.name;void 0===r.highlightFormatting&&(r.highlightFormatting=!1),void 0===r.maxBlockquoteDepth&&(r.maxBlockquoteDepth=0),void 0===r.underscoresBreakWords&&(r.underscoresBreakWords=!0),void 0===r.taskLists&&(r.taskLists=!1),void 0===r.strikethrough&&(r.strikethrough=!1),void 0===r.tokenTypeOverrides&&(r.tokenTypeOverrides={});var a={header:"header",code:"comment",quote:"quote",list1:"variable-2",list2:"variable-3",list3:"keyword",hr:"hr",image:"image",imageAltText:"image-alt-text",imageMarker:"image-marker",formatting:"formatting",linkInline:"link",linkEmail:"link",linkText:"link",linkHref:"string",em:"em",strong:"strong",strikethrough:"strikethrough"};for(var l in a)a.hasOwnProperty(l)&&r.tokenTypeOverrides[l]&&(a[l]=r.tokenTypeOverrides[l]);var s=/^([*\-_])(?:\s*\1){2,}\s*$/,u=/^(?:[*\-+]|^[0-9]+([.)]))\s+/,c=/^\[(x| )\](?=\s)/,f=r.allowAtxHeaderWithoutSpace?/^(#+)/:/^(#+)(?: |$)/,d=/^ *(?:\={1,}|-{1,})\s*$/,h=/^[^#!\[\]*_\\<>` "'(~]+/,p=new RegExp("^("+(r.fencedCodeBlocks===!0?"~~~+|```+":r.fencedCodeBlocks)+")[ \\t]*([\\w+#-]*)"),T={")":/^(?:[^\\\(\)]|\\.|\((?:[^\\\(\)]|\\.)*\))*?(?=\))/,"]":/^(?:[^\\\[\]]|\\.|\[(?:[^\\\[\\]]|\\.)*\])*?(?=\])/},q={startState:function(){return{f:b,prevLine:null,thisLine:null,block:b,htmlState:null,indentation:0,inline:S,text:C,formatting:!1,linkText:!1,linkHref:!1,linkTitle:!1,code:0,em:!1,strong:!1,header:0,hr:!1,taskList:!1,list:!1,listStack:[],quote:0,trailingSpace:0,trailingSpaceNewLine:!1,strikethrough:!1,fencedChars:null}},copyState:function(t){return{f:t.f,prevLine:t.prevLine,thisLine:t.thisLine,block:t.block,htmlState:t.htmlState&&e.copyState(n,t.htmlState),indentation:t.indentation,localMode:t.localMode,localState:t.localMode?e.copyState(t.localMode,t.localState):null,inline:t.inline,text:t.text,formatting:!1,linkTitle:t.linkTitle,code:t.code,em:t.em,strong:t.strong,strikethrough:t.strikethrough,header:t.header,hr:t.hr,taskList:t.taskList,list:t.list,listStack:t.listStack.slice(0),quote:t.quote,indentedCode:t.indentedCode,trailingSpace:t.trailingSpace,trailingSpaceNewLine:t.trailingSpaceNewLine,md_inside:t.md_inside,fencedChars:t.fencedChars}},token:function(e,t){if(t.formatting=!1,e!=t.thisLine){var r=t.header||t.hr;if(t.header=0,t.hr=!1,e.match(/^\s*$/,!0)||r){if(y(t),!r)return null;t.prevLine=null}t.prevLine=t.thisLine,t.thisLine=e,t.taskList=!1,t.trailingSpace=0,t.trailingSpaceNewLine=!1,t.f=t.block;var n=e.match(/^\s*/,!0)[0].replace(/\t/g,"    ").length;if(t.indentationDiff=Math.min(n-t.indentation,4),t.indentation=t.indentation+t.indentationDiff,n>0)return null}return t.f(e,t)},innerMode:function(e){return e.block==w?{state:e.htmlState,mode:n}:e.localState?{state:e.localState,mode:e.localMode}:{state:e,mode:q}},blankLine:y,getType:_,closeBrackets:"()[]{}''\"\"``",fold:"markdown"};return q},"xml"),e.defineMIME("text/x-markdown","markdown")}),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){"use strict";var t=/^(\s*)(>[> ]*|- \[[x ]\]\s|[*+-]\s|(\d+)([.)]))(\s*)/,r=/^(\s*)(>[> ]*|- \[[x ]\]|[*+-]|(\d+)[.)])(\s*)$/,n=/[*+-]\s/;e.commands.newlineAndIndentContinueMarkdownList=function(i){if(i.getOption("disableInput"))return e.Pass;for(var o=i.listSelections(),a=[],l=0;l<o.length;l++){var s=o[l].head,u=i.getStateAfter(s.line),c=u.list!==!1,f=0!==u.quote,d=i.getLine(s.line),h=t.exec(d);if(!o[l].empty()||!c&&!f||!h)return void i.execCommand("newlineAndIndent");if(r.test(d))i.replaceRange("",{line:s.line,ch:0},{line:s.line,ch:s.ch+1}),a[l]="\n";else{var p=h[1],m=h[5],g=n.test(h[2])||h[2].indexOf(">")>=0?h[2].replace("x"," "):parseInt(h[3],10)+1+h[4];a[l]="\n"+p+g+m}}i.replaceSelections(a)}}),function(e,t,r){"undefined"!=typeof e.Form.editor["form.main"].content&&(e.Form.editor["form.main"].content.setOption("mode","text/x-markdown"),e.Form.editor["form.main"].content.setOption("extraKeys",{Enter:"newlineAndIndentContinueMarkdownList"}))}(Panel,window,document);