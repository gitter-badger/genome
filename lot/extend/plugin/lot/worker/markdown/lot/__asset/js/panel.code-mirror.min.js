!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror"),require("../xml/xml"),require("../meta")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../xml/xml","../meta"],e):e(CodeMirror)}(function(e){"use strict";e.defineMode("markdown",function(t,i){function a(i){if(e.findModeByName){var n=e.findModeByName(i);n&&(i=n.mime||n.mimes[0])}var r=e.getMode(t,i);return"null"==r.name?null:r}function d(e,t,i){return t.f=t.inline=i,i(e,t)}function k(e,t,i){return t.f=t.block=i,i(e,t)}function p(e){return!e||!/\S/.test(e.string)}function v(e){return e.linkTitle=!1,e.em=!1,e.strong=!1,e.strikethrough=!1,e.quote=0,e.indentedCode=!1,r&&e.f==S&&(e.f=M,e.block=x),e.trailingSpace=0,e.trailingSpaceNewLine=!1,e.prevLine=e.thisLine,e.thisLine=null,null}function x(t,n){var r=t.sol(),f=n.list!==!1,m=n.indentedCode;n.indentedCode=!1,f&&(n.indentationDiff>=0?(n.indentationDiff<4&&(n.indentation-=n.indentationDiff),n.list=null):n.indentation>0?n.list=null:n.list=!1);var k=null;if(n.indentationDiff>=4)return t.skipToEnd(),m||p(n.prevLine)?(n.indentation-=4,n.indentedCode=!0,l.code):null;if(t.eatSpace())return null;if((k=t.match(h))&&k[1].length<=6)return n.header=k[1].length,i.highlightFormatting&&(n.formatting="header"),n.f=n.inline,q(n);if(!(p(n.prevLine)||n.quote||f||m)&&(k=t.match(g)))return n.header="="==k[0].charAt(0)?1:2,i.highlightFormatting&&(n.formatting="header"),n.f=n.inline,q(n);if(t.eat(">"))return n.quote=r?1:n.quote+1,i.highlightFormatting&&(n.formatting="quote"),t.eatSpace(),q(n);if("["===t.peek())return d(t,n,B);if(t.match(o,!0))return n.hr=!0,l.hr;if(k=t.match(s)){var v=k[1]?"ol":"ul";for(n.indentation=t.column()+t.current().length,n.list=!0;n.listStack&&t.column()<n.listStack[n.listStack.length-1];)n.listStack.pop();return n.listStack.push(n.indentation),i.taskLists&&t.match(u,!1)&&(n.taskList=!0),n.f=n.inline,i.highlightFormatting&&(n.formatting=["list","list-"+v]),q(n)}return i.fencedCodeBlocks&&(k=t.match(c,!0))?(n.fencedChars=k[1],n.localMode=a(k[2]),n.localMode&&(n.localState=e.startState(n.localMode)),n.f=n.block=L,i.highlightFormatting&&(n.formatting="code-block"),n.code=-1,q(n)):d(t,n,n.inline)}function S(t,i){var a=n.token(t,i.htmlState);if(!r){var l=e.innerMode(n,i.htmlState);("xml"==l.mode.name&&null===l.state.tagStart&&!l.state.context&&l.state.tokenize.isInText||i.md_inside&&t.current().indexOf(">")>-1)&&(i.f=M,i.block=x,i.htmlState=null)}return a}function L(e,t){return t.fencedChars&&e.match(t.fencedChars,!1)?(t.localMode=t.localState=null,t.f=t.block=F,null):t.localMode?t.localMode.token(e,t.localState):(e.skipToEnd(),l.code)}function F(e,t){e.match(t.fencedChars),t.block=x,t.f=M,t.fencedChars=null,i.highlightFormatting&&(t.formatting="code-block"),t.code=1;var n=q(t);return t.code=0,n}function q(e){var t=[];if(e.formatting){t.push(l.formatting),"string"==typeof e.formatting&&(e.formatting=[e.formatting]);for(var n=0;n<e.formatting.length;n++)t.push(l.formatting+"-"+e.formatting[n]),"header"===e.formatting[n]&&t.push(l.formatting+"-"+e.formatting[n]+"-"+e.header),"quote"===e.formatting[n]&&(!i.maxBlockquoteDepth||i.maxBlockquoteDepth>=e.quote?t.push(l.formatting+"-"+e.formatting[n]+"-"+e.quote):t.push("error"))}if(e.taskOpen)return t.push("meta"),t.length?t.join(" "):null;if(e.taskClosed)return t.push("property"),t.length?t.join(" "):null;if(e.linkHref?t.push(l.linkHref,"url"):(e.strong&&t.push(l.strong),e.em&&t.push(l.em),e.strikethrough&&t.push(l.strikethrough),e.linkText&&t.push(l.linkText),e.code&&t.push(l.code),e.image&&t.push(l.image),e.imageAltText&&t.push(l.imageAltText,"link"),e.imageMarker&&t.push(l.imageMarker)),e.header&&t.push(l.header,l.header+"-"+e.header),e.quote&&(t.push(l.quote),!i.maxBlockquoteDepth||i.maxBlockquoteDepth>=e.quote?t.push(l.quote+"-"+e.quote):t.push(l.quote+"-"+i.maxBlockquoteDepth)),e.list!==!1){var r=(e.listStack.length-1)%3;r?1===r?t.push(l.list2):t.push(l.list3):t.push(l.list1)}return e.trailingSpaceNewLine?t.push("trailing-space-new-line"):e.trailingSpace&&t.push("trailing-space-"+(e.trailingSpace%2?"a":"b")),t.length?t.join(" "):null}function w(e,t){return e.match(m,!0)?q(t):void 0}function M(t,r){var a=r.text(t,r);if("undefined"!=typeof a)return a;if(r.list)return r.list=null,q(r);if(r.taskList){var f="x"!==t.match(u,!0)[1];return f?r.taskOpen=!0:r.taskClosed=!0,i.highlightFormatting&&(r.formatting="task"),r.taskList=!1,q(r)}if(r.taskOpen=!1,r.taskClosed=!1,r.header&&t.match(/^#+$/,!0))return i.highlightFormatting&&(r.formatting="header"),q(r);var o=t.sol(),s=t.next();if(r.linkTitle){r.linkTitle=!1;var h=s;"("===s&&(h=")"),h=(h+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1");var g="^\\s*(?:[^"+h+"\\\\]+|\\\\\\\\|\\\\.)"+h;if(t.match(new RegExp(g),!0))return l.linkHref}if("`"===s){var m=r.formatting;i.highlightFormatting&&(r.formatting="code"),t.eatWhile("`");var c=t.current().length;if(0==r.code)return r.code=c,q(r);if(c==r.code){var d=q(r);return r.code=0,d}return r.formatting=m,q(r)}if(r.code)return q(r);if("\\"===s&&(t.next(),i.highlightFormatting)){var p=q(r),v=l.formatting+"-escape";return p?p+" "+v:v}if("!"===s&&t.match(/\[[^\]]*\] ?(?:\(|\[)/,!1))return r.imageMarker=!0,r.image=!0,i.highlightFormatting&&(r.formatting="image"),q(r);if("["===s&&r.imageMarker&&t.match(/[^\]]*\](\(.*?\)| ?\[.*?\])/,!1))return r.imageMarker=!1,r.imageAltText=!0,i.highlightFormatting&&(r.formatting="image"),q(r);if("]"===s&&r.imageAltText){i.highlightFormatting&&(r.formatting="image");var p=q(r);return r.imageAltText=!1,r.image=!1,r.inline=r.f=b,p}if("["===s&&t.match(/[^\]]*\](\(.*\)| ?\[.*?\])/,!1)&&!r.image)return r.linkText=!0,i.highlightFormatting&&(r.formatting="link"),q(r);if("]"===s&&r.linkText&&t.match(/\(.*?\)| ?\[.*?\]/,!1)){i.highlightFormatting&&(r.formatting="link");var p=q(r);return r.linkText=!1,r.inline=r.f=b,p}if("<"===s&&t.match(/^(https?|ftps?):\/\/(?:[^\\>]|\\.)+>/,!1)){r.f=r.inline=T,i.highlightFormatting&&(r.formatting="link");var p=q(r);return p?p+=" ":p="",p+l.linkInline}if("<"===s&&t.match(/^[^> \\]+@(?:[^\\>]|\\.)+>/,!1)){r.f=r.inline=T,i.highlightFormatting&&(r.formatting="link");var p=q(r);return p?p+=" ":p="",p+l.linkEmail}if("<"===s&&t.match(/^(!--|[a-z]+(?:\s+[a-z_:.\-]+(?:\s*=\s*[^ >]+)?)*\s*>)/i,!1)){var x=t.string.indexOf(">",t.pos);if(-1!=x){var L=t.string.substring(t.start,x);/markdown\s*=\s*('|"){0,1}1('|"){0,1}/.test(L)&&(r.md_inside=!0)}return t.backUp(1),r.htmlState=e.startState(n),k(t,r,S)}if("<"===s&&t.match(/^\/\w*?>/))return r.md_inside=!1,"tag";var F=!1;if(!i.underscoresBreakWords&&"_"===s&&"_"!==t.peek()&&t.match(/(\w)/,!1)){var w=t.pos-2;if(w>=0){var M=t.string.charAt(w);"_"!==M&&M.match(/(\w)/,!1)&&(F=!0)}}if("*"===s||"_"===s&&!F)if(o&&" "===t.peek());else{if(r.strong===s&&t.eat(s)){i.highlightFormatting&&(r.formatting="strong");var d=q(r);return r.strong=!1,d}if(!r.strong&&t.eat(s))return r.strong=s,i.highlightFormatting&&(r.formatting="strong"),q(r);if(r.em===s){i.highlightFormatting&&(r.formatting="em");var d=q(r);return r.em=!1,d}if(!r.em)return r.em=s,i.highlightFormatting&&(r.formatting="em"),q(r)}else if(" "===s&&(t.eat("*")||t.eat("_"))){if(" "===t.peek())return q(r);t.backUp(1)}if(i.strikethrough)if("~"===s&&t.eatWhile(s)){if(r.strikethrough){i.highlightFormatting&&(r.formatting="strikethrough");var d=q(r);return r.strikethrough=!1,d}if(t.match(/^[^\s]/,!1))return r.strikethrough=!0,i.highlightFormatting&&(r.formatting="strikethrough"),q(r)}else if(" "===s&&t.match(/^~~/,!0)){if(" "===t.peek())return q(r);t.backUp(2)}return" "===s&&(t.match(/ +$/,!1)?r.trailingSpace++:r.trailingSpace&&(r.trailingSpaceNewLine=!0)),q(r)}function T(e,t){var n=e.next();if(">"===n){t.f=t.inline=M,i.highlightFormatting&&(t.formatting="link");var r=q(t);return r?r+=" ":r="",r+l.linkInline}return e.match(/^[^>]+/,!0),l.linkInline}function b(e,t){if(e.eatSpace())return null;var n=e.next();return"("===n||"["===n?(t.f=t.inline=y("("===n?")":"]",0),i.highlightFormatting&&(t.formatting="link-string"),t.linkHref=!0,q(t)):"error"}function y(e){return function(t,n){var r=t.next();if(r===e){n.f=n.inline=M,i.highlightFormatting&&(n.formatting="link-string");var a=q(n);return n.linkHref=!1,a}return t.match(C[e]),n.linkHref=!0,q(n)}}function B(e,t){return e.match(/^([^\]\\]|\\.)*\]:/,!1)?(t.f=O,e.next(),i.highlightFormatting&&(t.formatting="link"),t.linkText=!0,q(t)):d(e,t,M)}function O(e,t){if(e.match(/^\]:/,!0)){t.f=t.inline=A,i.highlightFormatting&&(t.formatting="link");var n=q(t);return t.linkText=!1,n}return e.match(/^([^\]\\]|\\.)+/,!0),l.linkText}function A(e,t){return e.eatSpace()?null:(e.match(/^[^\s]+/,!0),void 0===e.peek()?t.linkTitle=!0:e.match(/^(?:\s+(?:"(?:[^"\\]|\\\\|\\.)+"|'(?:[^'\\]|\\\\|\\.)+'|\((?:[^)\\]|\\\\|\\.)+\)))?/,!0),t.f=t.inline=M,l.linkHref+" url")}var n=e.getMode(t,"text/html"),r="null"==n.name;void 0===i.highlightFormatting&&(i.highlightFormatting=!1),void 0===i.maxBlockquoteDepth&&(i.maxBlockquoteDepth=0),void 0===i.underscoresBreakWords&&(i.underscoresBreakWords=!0),void 0===i.taskLists&&(i.taskLists=!1),void 0===i.strikethrough&&(i.strikethrough=!1),void 0===i.tokenTypeOverrides&&(i.tokenTypeOverrides={});var l={header:"header",code:"comment",quote:"quote",list1:"variable-2",list2:"variable-3",list3:"keyword",hr:"hr",image:"image",imageAltText:"image-alt-text",imageMarker:"image-marker",formatting:"formatting",linkInline:"link",linkEmail:"link",linkText:"link",linkHref:"string",em:"em",strong:"strong",strikethrough:"strikethrough"};for(var f in l)l.hasOwnProperty(f)&&i.tokenTypeOverrides[f]&&(l[f]=i.tokenTypeOverrides[f]);var o=/^([*\-_])(?:\s*\1){2,}\s*$/,s=/^(?:[*\-+]|^[0-9]+([.)]))\s+/,u=/^\[(x| )\](?=\s)/,h=i.allowAtxHeaderWithoutSpace?/^(#+)/:/^(#+)(?: |$)/,g=/^ *(?:\={1,}|-{1,})\s*$/,m=/^[^#!\[\]*_\\<>` "'(~]+/,c=new RegExp("^("+(i.fencedCodeBlocks===!0?"~~~+|```+":i.fencedCodeBlocks)+")[ \\t]*([\\w+#-]*)"),C={")":/^(?:[^\\\(\)]|\\.|\((?:[^\\\(\)]|\\.)*\))*?(?=\))/,"]":/^(?:[^\\\[\]]|\\.|\[(?:[^\\\[\\]]|\\.)*\])*?(?=\])/},D={startState:function(){return{f:x,prevLine:null,thisLine:null,block:x,htmlState:null,indentation:0,inline:M,text:w,formatting:!1,linkText:!1,linkHref:!1,linkTitle:!1,code:0,em:!1,strong:!1,header:0,hr:!1,taskList:!1,list:!1,listStack:[],quote:0,trailingSpace:0,trailingSpaceNewLine:!1,strikethrough:!1,fencedChars:null}},copyState:function(t){return{f:t.f,prevLine:t.prevLine,thisLine:t.thisLine,block:t.block,htmlState:t.htmlState&&e.copyState(n,t.htmlState),indentation:t.indentation,localMode:t.localMode,localState:t.localMode?e.copyState(t.localMode,t.localState):null,inline:t.inline,text:t.text,formatting:!1,linkTitle:t.linkTitle,code:t.code,em:t.em,strong:t.strong,strikethrough:t.strikethrough,header:t.header,hr:t.hr,taskList:t.taskList,list:t.list,listStack:t.listStack.slice(0),quote:t.quote,indentedCode:t.indentedCode,trailingSpace:t.trailingSpace,trailingSpaceNewLine:t.trailingSpaceNewLine,md_inside:t.md_inside,fencedChars:t.fencedChars}},token:function(e,t){if(t.formatting=!1,e!=t.thisLine){var i=t.header||t.hr;if(t.header=0,t.hr=!1,e.match(/^\s*$/,!0)||i){if(v(t),!i)return null;t.prevLine=null}t.prevLine=t.thisLine,t.thisLine=e,t.taskList=!1,t.trailingSpace=0,t.trailingSpaceNewLine=!1,t.f=t.block;var n=e.match(/^\s*/,!0)[0].replace(/\t/g,"    ").length;if(t.indentationDiff=Math.min(n-t.indentation,4),t.indentation=t.indentation+t.indentationDiff,n>0)return null}return t.f(e,t)},innerMode:function(e){return e.block==S?{state:e.htmlState,mode:n}:e.localState?{state:e.localState,mode:e.localMode}:{state:e,mode:D}},blankLine:v,getType:q,closeBrackets:"()[]{}''\"\"``",fold:"markdown"};return D},"xml"),e.defineMIME("text/x-markdown","markdown")}),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){"use strict";var t=/^(\s*)(>[> ]*|- \[[x ]\]\s|[*+-]\s|(\d+)([.)]))(\s*)/,i=/^(\s*)(>[> ]*|- \[[x ]\]|[*+-]|(\d+)[.)])(\s*)$/,n=/[*+-]\s/;e.commands.newlineAndIndentContinueMarkdownList=function(r){if(r.getOption("disableInput"))return e.Pass;for(var a=r.listSelections(),l=[],f=0;f<a.length;f++){var o=a[f].head,s=r.getStateAfter(o.line),u=s.list!==!1,h=0!==s.quote,g=r.getLine(o.line),m=t.exec(g);if(!a[f].empty()||!u&&!h||!m)return void r.execCommand("newlineAndIndent");if(i.test(g))r.replaceRange("",{line:o.line,ch:0},{line:o.line,ch:o.ch+1}),l[f]="\n";else{var c=m[1],d=m[5],k=n.test(m[2])||m[2].indexOf(">")>=0?m[2].replace("x"," "):parseInt(m[3],10)+1+m[4];l[f]="\n"+c+k+d}}r.replaceSelections(l)}}),function(e,t,i){if(!e.is.x(e.Form.editor["form.main"].content)){var n=e.Form.editor["form.main"].content;n.setOption("mode","text/x-markdown"),n.setOption("extraKeys",{Enter:"newlineAndIndentContinueMarkdownList"})}}(Panel,window,document);