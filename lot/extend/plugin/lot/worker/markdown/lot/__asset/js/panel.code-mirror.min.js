!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror"),require("../xml/xml"),require("../meta")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../xml/xml","../meta"],e):e(CodeMirror)}(function(e){"use strict";e.defineMode("markdown",function(n,t){function u(t){if(e.findModeByName){var r=e.findModeByName(t);r&&(t=r.mime||r.mimes[0])}var i=e.getMode(n,t);return"null"==i.name?null:i}function m(e,n,t){return n.f=n.inline=t,t(e,n)}function g(e,n,t){return n.f=n.block=t,t(e,n)}function v(e){return!e||!/\S/.test(e.string)}function y(e){return e.linkTitle=!1,e.em=!1,e.strong=!1,e.strikethrough=!1,e.quote=0,e.indentedCode=!1,i&&e.f==b&&(e.f=E,e.block=k),e.trailingSpace=0,e.trailingSpaceNewLine=!1,e.prevLine=e.thisLine,e.thisLine=null,null}function k(n,r){var i=n.sol(),f=r.list!==!1,h=r.indentedCode;r.indentedCode=!1,f&&(r.indentationDiff>=0?(r.indentationDiff<4&&(r.indentation-=r.indentationDiff),r.list=null):r.indentation>0?r.list=null:r.list=!1);var g=null;if(r.indentationDiff>=4)return n.skipToEnd(),h||v(r.prevLine)?(r.indentation-=4,r.indentedCode=!0,o.code):null;if(n.eatSpace())return null;if((g=n.match(s))&&g[1].length<=6)return r.header=g[1].length,t.highlightFormatting&&(r.formatting="header"),r.f=r.inline,C(r);if(!(v(r.prevLine)||r.quote||f||h)&&(g=n.match(d)))return r.header="="==g[0].charAt(0)?1:2,t.highlightFormatting&&(r.formatting="header"),r.f=r.inline,C(r);if(n.eat(">"))return r.quote=i?1:r.quote+1,t.highlightFormatting&&(r.formatting="quote"),n.eatSpace(),C(r);if("["===n.peek())return m(n,r,j);if(n.match(c,!0))return r.hr=!0,o.hr;if(g=n.match(a)){var y=g[1]?"ol":"ul";for(r.indentation=n.column()+n.current().length,r.list=!0;r.listStack&&n.column()<r.listStack[r.listStack.length-1];)r.listStack.pop();return r.listStack.push(r.indentation),t.taskLists&&n.match(l,!1)&&(r.taskList=!0),r.f=r.inline,t.highlightFormatting&&(r.formatting=["list","list-"+y]),C(r)}return t.fencedCodeBlocks&&(g=n.match(p,!0))?(r.fencedChars=g[1],r.localMode=u(g[2]),r.localMode&&(r.localState=e.startState(r.localMode)),r.f=r.block=x,t.highlightFormatting&&(r.formatting="code-block"),r.code=-1,C(r)):m(n,r,r.inline)}function b(n,t){var u=r.token(n,t.htmlState);if(!i){var o=e.innerMode(r,t.htmlState);("xml"==o.mode.name&&null===o.state.tagStart&&!o.state.context&&o.state.tokenize.isInText||t.md_inside&&n.current().indexOf(">")>-1)&&(t.f=E,t.block=k,t.htmlState=null)}return u}function x(e,n){return n.fencedChars&&e.match(n.fencedChars,!1)?(n.localMode=n.localState=null,n.f=n.block=w,null):n.localMode?n.localMode.token(e,n.localState):(e.skipToEnd(),o.code)}function w(e,n){e.match(n.fencedChars),n.block=k,n.f=E,n.fencedChars=null,t.highlightFormatting&&(n.formatting="code-block"),n.code=1;var r=C(n);return n.code=0,r}function C(e){var n=[];if(e.formatting){n.push(o.formatting),"string"==typeof e.formatting&&(e.formatting=[e.formatting]);for(var r=0;r<e.formatting.length;r++)n.push(o.formatting+"-"+e.formatting[r]),"header"===e.formatting[r]&&n.push(o.formatting+"-"+e.formatting[r]+"-"+e.header),"quote"===e.formatting[r]&&(!t.maxBlockquoteDepth||t.maxBlockquoteDepth>=e.quote?n.push(o.formatting+"-"+e.formatting[r]+"-"+e.quote):n.push("error"))}if(e.taskOpen)return n.push("meta"),n.length?n.join(" "):null;if(e.taskClosed)return n.push("property"),n.length?n.join(" "):null;if(e.linkHref?n.push(o.linkHref,"url"):(e.strong&&n.push(o.strong),e.em&&n.push(o.em),e.strikethrough&&n.push(o.strikethrough),e.linkText&&n.push(o.linkText),e.code&&n.push(o.code),e.image&&n.push(o.image),e.imageAltText&&n.push(o.imageAltText,"link"),e.imageMarker&&n.push(o.imageMarker)),e.header&&n.push(o.header,o.header+"-"+e.header),e.quote&&(n.push(o.quote),!t.maxBlockquoteDepth||t.maxBlockquoteDepth>=e.quote?n.push(o.quote+"-"+e.quote):n.push(o.quote+"-"+t.maxBlockquoteDepth)),e.list!==!1){var i=(e.listStack.length-1)%3;i?1===i?n.push(o.list2):n.push(o.list3):n.push(o.list1)}return e.trailingSpaceNewLine?n.push("trailing-space-new-line"):e.trailingSpace&&n.push("trailing-space-"+(e.trailingSpace%2?"a":"b")),n.length?n.join(" "):null}function L(e,n){return e.match(h,!0)?C(n):void 0}function E(n,i){var u=i.text(n,i);if("undefined"!=typeof u)return u;if(i.list)return i.list=null,C(i);if(i.taskList){var f="x"!==n.match(l,!0)[1];return f?i.taskOpen=!0:i.taskClosed=!0,t.highlightFormatting&&(i.formatting="task"),i.taskList=!1,C(i)}if(i.taskOpen=!1,i.taskClosed=!1,i.header&&n.match(/^#+$/,!0))return t.highlightFormatting&&(i.formatting="header"),C(i);var c=n.sol(),a=n.next();if(i.linkTitle){i.linkTitle=!1;var s=a;"("===a&&(s=")"),s=(s+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1");var d="^\\s*(?:[^"+s+"\\\\]+|\\\\\\\\|\\\\.)"+s;if(n.match(new RegExp(d),!0))return o.linkHref}if("`"===a){var h=i.formatting;t.highlightFormatting&&(i.formatting="code"),n.eatWhile("`");var p=n.current().length;if(0==i.code)return i.code=p,C(i);if(p==i.code){var m=C(i);return i.code=0,m}return i.formatting=h,C(i)}if(i.code)return C(i);if("\\"===a&&(n.next(),t.highlightFormatting)){var v=C(i),y=o.formatting+"-escape";return v?v+" "+y:y}if("!"===a&&n.match(/\[[^\]]*\] ?(?:\(|\[)/,!1))return i.imageMarker=!0,i.image=!0,t.highlightFormatting&&(i.formatting="image"),C(i);if("["===a&&i.imageMarker&&n.match(/[^\]]*\](\(.*?\)| ?\[.*?\])/,!1))return i.imageMarker=!1,i.imageAltText=!0,t.highlightFormatting&&(i.formatting="image"),C(i);if("]"===a&&i.imageAltText){t.highlightFormatting&&(i.formatting="image");var v=C(i);return i.imageAltText=!1,i.image=!1,i.inline=i.f=S,v}if("["===a&&n.match(/[^\]]*\](\(.*\)| ?\[.*?\])/,!1)&&!i.image)return i.linkText=!0,t.highlightFormatting&&(i.formatting="link"),C(i);if("]"===a&&i.linkText&&n.match(/\(.*?\)| ?\[.*?\]/,!1)){t.highlightFormatting&&(i.formatting="link");var v=C(i);return i.linkText=!1,i.inline=i.f=S,v}if("<"===a&&n.match(/^(https?|ftps?):\/\/(?:[^\\>]|\\.)+>/,!1)){i.f=i.inline=F,t.highlightFormatting&&(i.formatting="link");var v=C(i);return v?v+=" ":v="",v+o.linkInline}if("<"===a&&n.match(/^[^> \\]+@(?:[^\\>]|\\.)+>/,!1)){i.f=i.inline=F,t.highlightFormatting&&(i.formatting="link");var v=C(i);return v?v+=" ":v="",v+o.linkEmail}if("<"===a&&n.match(/^(!--|[a-z]+(?:\s+[a-z_:.\-]+(?:\s*=\s*[^ >]+)?)*\s*>)/i,!1)){var k=n.string.indexOf(">",n.pos);if(-1!=k){var x=n.string.substring(n.start,k);/markdown\s*=\s*('|"){0,1}1('|"){0,1}/.test(x)&&(i.md_inside=!0)}return n.backUp(1),i.htmlState=e.startState(r),g(n,i,b)}if("<"===a&&n.match(/^\/\w*?>/))return i.md_inside=!1,"tag";var w=!1;if(!t.underscoresBreakWords&&"_"===a&&"_"!==n.peek()&&n.match(/(\w)/,!1)){var L=n.pos-2;if(L>=0){var E=n.string.charAt(L);"_"!==E&&E.match(/(\w)/,!1)&&(w=!0)}}if("*"===a||"_"===a&&!w)if(c&&" "===n.peek());else{if(i.strong===a&&n.eat(a)){t.highlightFormatting&&(i.formatting="strong");var m=C(i);return i.strong=!1,m}if(!i.strong&&n.eat(a))return i.strong=a,t.highlightFormatting&&(i.formatting="strong"),C(i);if(i.em===a){t.highlightFormatting&&(i.formatting="em");var m=C(i);return i.em=!1,m}if(!i.em)return i.em=a,t.highlightFormatting&&(i.formatting="em"),C(i)}else if(" "===a&&(n.eat("*")||n.eat("_"))){if(" "===n.peek())return C(i);n.backUp(1)}if(t.strikethrough)if("~"===a&&n.eatWhile(a)){if(i.strikethrough){t.highlightFormatting&&(i.formatting="strikethrough");var m=C(i);return i.strikethrough=!1,m}if(n.match(/^[^\s]/,!1))return i.strikethrough=!0,t.highlightFormatting&&(i.formatting="strikethrough"),C(i)}else if(" "===a&&n.match(/^~~/,!0)){if(" "===n.peek())return C(i);n.backUp(2)}return" "===a&&(n.match(/ +$/,!1)?i.trailingSpace++:i.trailingSpace&&(i.trailingSpaceNewLine=!0)),C(i)}function F(e,n){var r=e.next();if(">"===r){n.f=n.inline=E,t.highlightFormatting&&(n.formatting="link");var i=C(n);return i?i+=" ":i="",i+o.linkInline}return e.match(/^[^>]+/,!0),o.linkInline}function S(e,n){if(e.eatSpace())return null;var r=e.next();return"("===r||"["===r?(n.f=n.inline=M("("===r?")":"]",0),t.highlightFormatting&&(n.formatting="link-string"),n.linkHref=!0,C(n)):"error"}function M(e){return function(n,r){var i=n.next();if(i===e){r.f=r.inline=E,t.highlightFormatting&&(r.formatting="link-string");var u=C(r);return r.linkHref=!1,u}return n.match(T[e]),r.linkHref=!0,C(r)}}function j(e,n){return e.match(/^([^\]\\]|\\.)*\]:/,!1)?(n.f=q,e.next(),t.highlightFormatting&&(n.formatting="link"),n.linkText=!0,C(n)):m(e,n,E)}function q(e,n){if(e.match(/^\]:/,!0)){n.f=n.inline=A,t.highlightFormatting&&(n.formatting="link");var r=C(n);return n.linkText=!1,r}return e.match(/^([^\]\\]|\\.)+/,!0),o.linkText}function A(e,n){return e.eatSpace()?null:(e.match(/^[^\s]+/,!0),void 0===e.peek()?n.linkTitle=!0:e.match(/^(?:\s+(?:"(?:[^"\\]|\\\\|\\.)+"|'(?:[^'\\]|\\\\|\\.)+'|\((?:[^)\\]|\\\\|\\.)+\)))?/,!0),n.f=n.inline=E,o.linkHref+" url")}var r=e.getMode(n,"text/html"),i="null"==r.name;void 0===t.highlightFormatting&&(t.highlightFormatting=!1),void 0===t.maxBlockquoteDepth&&(t.maxBlockquoteDepth=0),void 0===t.underscoresBreakWords&&(t.underscoresBreakWords=!0),void 0===t.taskLists&&(t.taskLists=!1),void 0===t.strikethrough&&(t.strikethrough=!1),void 0===t.tokenTypeOverrides&&(t.tokenTypeOverrides={});var o={header:"header",code:"comment",quote:"quote",list1:"variable-2",list2:"variable-3",list3:"keyword",hr:"hr",image:"image",imageAltText:"image-alt-text",imageMarker:"image-marker",formatting:"formatting",linkInline:"link",linkEmail:"link",linkText:"link",linkHref:"string",em:"em",strong:"strong",strikethrough:"strikethrough"};for(var f in o)o.hasOwnProperty(f)&&t.tokenTypeOverrides[f]&&(o[f]=t.tokenTypeOverrides[f]);var c=/^([*\-_])(?:\s*\1){2,}\s*$/,a=/^(?:[*\-+]|^[0-9]+([.)]))\s+/,l=/^\[(x| )\](?=\s)/,s=t.allowAtxHeaderWithoutSpace?/^(#+)/:/^(#+)(?: |$)/,d=/^ *(?:\={1,}|-{1,})\s*$/,h=/^[^#!\[\]*_\\<>` "'(~]+/,p=new RegExp("^("+(t.fencedCodeBlocks===!0?"~~~+|```+":t.fencedCodeBlocks)+")[ \\t]*([\\w+#-]*)"),T={")":/^(?:[^\\\(\)]|\\.|\((?:[^\\\(\)]|\\.)*\))*?(?=\))/,"]":/^(?:[^\\\[\]]|\\.|\[(?:[^\\\[\\]]|\\.)*\])*?(?=\])/},N={startState:function(){return{f:k,prevLine:null,thisLine:null,block:k,htmlState:null,indentation:0,inline:E,text:L,formatting:!1,linkText:!1,linkHref:!1,linkTitle:!1,code:0,em:!1,strong:!1,header:0,hr:!1,taskList:!1,list:!1,listStack:[],quote:0,trailingSpace:0,trailingSpaceNewLine:!1,strikethrough:!1,fencedChars:null}},copyState:function(n){return{f:n.f,prevLine:n.prevLine,thisLine:n.thisLine,block:n.block,htmlState:n.htmlState&&e.copyState(r,n.htmlState),indentation:n.indentation,localMode:n.localMode,localState:n.localMode?e.copyState(n.localMode,n.localState):null,inline:n.inline,text:n.text,formatting:!1,linkTitle:n.linkTitle,code:n.code,em:n.em,strong:n.strong,strikethrough:n.strikethrough,header:n.header,hr:n.hr,taskList:n.taskList,list:n.list,listStack:n.listStack.slice(0),quote:n.quote,indentedCode:n.indentedCode,trailingSpace:n.trailingSpace,trailingSpaceNewLine:n.trailingSpaceNewLine,md_inside:n.md_inside,fencedChars:n.fencedChars}},token:function(e,n){if(n.formatting=!1,e!=n.thisLine){var t=n.header||n.hr;if(n.header=0,n.hr=!1,e.match(/^\s*$/,!0)||t){if(y(n),!t)return null;n.prevLine=null}n.prevLine=n.thisLine,n.thisLine=e,n.taskList=!1,n.trailingSpace=0,n.trailingSpaceNewLine=!1,n.f=n.block;var r=e.match(/^\s*/,!0)[0].replace(/\t/g,"    ").length;if(n.indentationDiff=Math.min(r-n.indentation,4),n.indentation=n.indentation+n.indentationDiff,r>0)return null}return n.f(e,n)},innerMode:function(e){return e.block==b?{state:e.htmlState,mode:r}:e.localState?{state:e.localState,mode:e.localMode}:{state:e,mode:N}},blankLine:y,getType:C,closeBrackets:"()[]{}''\"\"``",fold:"markdown"};return N},"xml"),e.defineMIME("text/x-markdown","markdown")}),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){"use strict";var n=/^(\s*)(>[> ]*|- \[[x ]\]\s|[*+-]\s|(\d+)([.)]))(\s*)/,t=/^(\s*)(>[> ]*|- \[[x ]\]|[*+-]|(\d+)[.)])(\s*)$/,r=/[*+-]\s/;e.commands.newlineAndIndentContinueMarkdownList=function(i){if(i.getOption("disableInput"))return e.Pass;for(var u=i.listSelections(),o=[],f=0;f<u.length;f++){var c=u[f].head,a=i.getStateAfter(c.line),l=a.list!==!1,s=0!==a.quote,d=i.getLine(c.line),h=n.exec(d);if(!u[f].empty()||!l&&!s||!h)return void i.execCommand("newlineAndIndent");if(t.test(d))i.replaceRange("",{line:c.line,ch:0},{line:c.line,ch:c.ch+1}),o[f]="\n";else{var p=h[1],m=h[5],g=r.test(h[2])||h[2].indexOf(">")>=0?h[2].replace("x"," "):parseInt(h[3],10)+1+h[4];o[f]="\n"+p+g+m}}i.replaceSelections(o)}}),function(e,n,t){if(!e.is.x(e.Form.editor["form.main"].content)){var r=e.Form.editor["form.main"].content;r.setOption("mode","text/x-markdown"),r.addKeyMap({Enter:"newlineAndIndentContinueMarkdownList"})}}(Panel,window,document);