!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror"),require("../xml/xml"),require("../meta")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../xml/xml","../meta"],e):e(CodeMirror)}(function(e){"use strict";e.defineMode("markdown",function(t,n){function o(n){if(e.findModeByName){var r=e.findModeByName(n);r&&(n=r.mime||r.mimes[0])}var i=e.getMode(t,n);return"null"==i.name?null:i}function m(e,t,n){return t.f=t.inline=n,n(e,t)}function g(e,t,n){return t.f=t.block=n,n(e,t)}function v(e){return!e||!/\S/.test(e.string)}function y(e){return e.linkTitle=!1,e.em=!1,e.strong=!1,e.strikethrough=!1,e.quote=0,e.indentedCode=!1,i&&e.f==k&&(e.f=L,e.block=b),e.trailingSpace=0,e.trailingSpaceNewLine=!1,e.prevLine=e.thisLine,e.thisLine=null,null}function b(t,r){var i=t.sol(),a=r.list!==!1,h=r.indentedCode;r.indentedCode=!1,a&&(r.indentationDiff>=0?(r.indentationDiff<4&&(r.indentation-=r.indentationDiff),r.list=null):r.indentation>0?r.list=null:r.list=!1);var g=null;if(r.indentationDiff>=4)return t.skipToEnd(),h||v(r.prevLine)?(r.indentation-=4,r.indentedCode=!0,u.code):null;if(t.eatSpace())return null;if((g=t.match(c))&&g[1].length<=6)return r.header=g[1].length,n.highlightFormatting&&(r.formatting="header"),r.f=r.inline,C(r);if(!(v(r.prevLine)||r.quote||a||h)&&(g=t.match(d)))return r.header="="==g[0].charAt(0)?1:2,n.highlightFormatting&&(r.formatting="header"),r.f=r.inline,C(r);if(t.eat(">"))return r.quote=i?1:r.quote+1,n.highlightFormatting&&(r.formatting="quote"),t.eatSpace(),C(r);if("["===t.peek())return m(t,r,E);if(t.match(f,!0))return r.hr=!0,u.hr;if(g=t.match(l)){var y=g[1]?"ol":"ul";for(r.indentation=t.column()+t.current().length,r.list=!0;r.listStack&&t.column()<r.listStack[r.listStack.length-1];)r.listStack.pop();return r.listStack.push(r.indentation),n.taskLists&&t.match(s,!1)&&(r.taskList=!0),r.f=r.inline,n.highlightFormatting&&(r.formatting=["list","list-"+y]),C(r)}return n.fencedCodeBlocks&&(g=t.match(p,!0))?(r.fencedChars=g[1],r.localMode=o(g[2]),r.localMode&&(r.localState=e.startState(r.localMode)),r.f=r.block=x,n.highlightFormatting&&(r.formatting="code-block"),r.code=-1,C(r)):m(t,r,r.inline)}function k(t,n){var o=r.token(t,n.htmlState);if(!i){var u=e.innerMode(r,n.htmlState);("xml"==u.mode.name&&null===u.state.tagStart&&!u.state.context&&u.state.tokenize.isInText||n.md_inside&&t.current().indexOf(">")>-1)&&(n.f=L,n.block=b,n.htmlState=null)}return o}function x(e,t){return t.fencedChars&&e.match(t.fencedChars,!1)?(t.localMode=t.localState=null,t.f=t.block=w,null):t.localMode?t.localMode.token(e,t.localState):(e.skipToEnd(),u.code)}function w(e,t){e.match(t.fencedChars),t.block=b,t.f=L,t.fencedChars=null,n.highlightFormatting&&(t.formatting="code-block"),t.code=1;var r=C(t);return t.code=0,r}function C(e){var t=[];if(e.formatting){t.push(u.formatting),"string"==typeof e.formatting&&(e.formatting=[e.formatting]);for(var r=0;r<e.formatting.length;r++)t.push(u.formatting+"-"+e.formatting[r]),"header"===e.formatting[r]&&t.push(u.formatting+"-"+e.formatting[r]+"-"+e.header),"quote"===e.formatting[r]&&(!n.maxBlockquoteDepth||n.maxBlockquoteDepth>=e.quote?t.push(u.formatting+"-"+e.formatting[r]+"-"+e.quote):t.push("error"))}if(e.taskOpen)return t.push("meta"),t.length?t.join(" "):null;if(e.taskClosed)return t.push("property"),t.length?t.join(" "):null;if(e.linkHref?t.push(u.linkHref,"url"):(e.strong&&t.push(u.strong),e.em&&t.push(u.em),e.strikethrough&&t.push(u.strikethrough),e.linkText&&t.push(u.linkText),e.code&&t.push(u.code),e.image&&t.push(u.image),e.imageAltText&&t.push(u.imageAltText,"link"),e.imageMarker&&t.push(u.imageMarker)),e.header&&t.push(u.header,u.header+"-"+e.header),e.quote&&(t.push(u.quote),!n.maxBlockquoteDepth||n.maxBlockquoteDepth>=e.quote?t.push(u.quote+"-"+e.quote):t.push(u.quote+"-"+n.maxBlockquoteDepth)),e.list!==!1){var i=(e.listStack.length-1)%3;i?1===i?t.push(u.list2):t.push(u.list3):t.push(u.list1)}return e.trailingSpaceNewLine?t.push("trailing-space-new-line"):e.trailingSpace&&t.push("trailing-space-"+(e.trailingSpace%2?"a":"b")),t.length?t.join(" "):null}function S(e,t){return e.match(h,!0)?C(t):void 0}function L(t,i){var o=i.text(t,i);if("undefined"!=typeof o)return o;if(i.list)return i.list=null,C(i);if(i.taskList){var a="x"!==t.match(s,!0)[1];return a?i.taskOpen=!0:i.taskClosed=!0,n.highlightFormatting&&(i.formatting="task"),i.taskList=!1,C(i)}if(i.taskOpen=!1,i.taskClosed=!1,i.header&&t.match(/^#+$/,!0))return n.highlightFormatting&&(i.formatting="header"),C(i);var f=t.sol(),l=t.next();if(i.linkTitle){i.linkTitle=!1;var c=l;"("===l&&(c=")"),c=(c+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1");var d="^\\s*(?:[^"+c+"\\\\]+|\\\\\\\\|\\\\.)"+c;if(t.match(new RegExp(d),!0))return u.linkHref}if("`"===l){var h=i.formatting;n.highlightFormatting&&(i.formatting="code"),t.eatWhile("`");var p=t.current().length;if(0==i.code)return i.code=p,C(i);if(p==i.code){var m=C(i);return i.code=0,m}return i.formatting=h,C(i)}if(i.code)return C(i);if("\\"===l&&(t.next(),n.highlightFormatting)){var v=C(i),y=u.formatting+"-escape";return v?v+" "+y:y}if("!"===l&&t.match(/\[[^\]]*\] ?(?:\(|\[)/,!1))return i.imageMarker=!0,i.image=!0,n.highlightFormatting&&(i.formatting="image"),C(i);if("["===l&&i.imageMarker&&t.match(/[^\]]*\](\(.*?\)| ?\[.*?\])/,!1))return i.imageMarker=!1,i.imageAltText=!0,n.highlightFormatting&&(i.formatting="image"),C(i);if("]"===l&&i.imageAltText){n.highlightFormatting&&(i.formatting="image");var v=C(i);return i.imageAltText=!1,i.image=!1,i.inline=i.f=_,v}if("["===l&&t.match(/[^\]]*\](\(.*\)| ?\[.*?\])/,!1)&&!i.image)return i.linkText=!0,n.highlightFormatting&&(i.formatting="link"),C(i);if("]"===l&&i.linkText&&t.match(/\(.*?\)| ?\[.*?\]/,!1)){n.highlightFormatting&&(i.formatting="link");var v=C(i);return i.linkText=!1,i.inline=i.f=_,v}if("<"===l&&t.match(/^(https?|ftps?):\/\/(?:[^\\>]|\\.)+>/,!1)){i.f=i.inline=T,n.highlightFormatting&&(i.formatting="link");var v=C(i);return v?v+=" ":v="",v+u.linkInline}if("<"===l&&t.match(/^[^> \\]+@(?:[^\\>]|\\.)+>/,!1)){i.f=i.inline=T,n.highlightFormatting&&(i.formatting="link");var v=C(i);return v?v+=" ":v="",v+u.linkEmail}if("<"===l&&t.match(/^(!--|[a-z]+(?:\s+[a-z_:.\-]+(?:\s*=\s*[^ >]+)?)*\s*>)/i,!1)){var b=t.string.indexOf(">",t.pos);if(-1!=b){var x=t.string.substring(t.start,b);/markdown\s*=\s*('|"){0,1}1('|"){0,1}/.test(x)&&(i.md_inside=!0)}return t.backUp(1),i.htmlState=e.startState(r),g(t,i,k)}if("<"===l&&t.match(/^\/\w*?>/))return i.md_inside=!1,"tag";var w=!1;if(!n.underscoresBreakWords&&"_"===l&&"_"!==t.peek()&&t.match(/(\w)/,!1)){var S=t.pos-2;if(S>=0){var L=t.string.charAt(S);"_"!==L&&L.match(/(\w)/,!1)&&(w=!0)}}if("*"===l||"_"===l&&!w)if(f&&" "===t.peek());else{if(i.strong===l&&t.eat(l)){n.highlightFormatting&&(i.formatting="strong");var m=C(i);return i.strong=!1,m}if(!i.strong&&t.eat(l))return i.strong=l,n.highlightFormatting&&(i.formatting="strong"),C(i);if(i.em===l){n.highlightFormatting&&(i.formatting="em");var m=C(i);return i.em=!1,m}if(!i.em)return i.em=l,n.highlightFormatting&&(i.formatting="em"),C(i)}else if(" "===l&&(t.eat("*")||t.eat("_"))){if(" "===t.peek())return C(i);t.backUp(1)}if(n.strikethrough)if("~"===l&&t.eatWhile(l)){if(i.strikethrough){n.highlightFormatting&&(i.formatting="strikethrough");var m=C(i);return i.strikethrough=!1,m}if(t.match(/^[^\s]/,!1))return i.strikethrough=!0,n.highlightFormatting&&(i.formatting="strikethrough"),C(i)}else if(" "===l&&t.match(/^~~/,!0)){if(" "===t.peek())return C(i);t.backUp(2)}return" "===l&&(t.match(/ +$/,!1)?i.trailingSpace++:i.trailingSpace&&(i.trailingSpaceNewLine=!0)),C(i)}function T(e,t){var r=e.next();if(">"===r){t.f=t.inline=L,n.highlightFormatting&&(t.formatting="link");var i=C(t);return i?i+=" ":i="",i+u.linkInline}return e.match(/^[^>]+/,!0),u.linkInline}function _(e,t){if(e.eatSpace())return null;var r=e.next();return"("===r||"["===r?(t.f=t.inline=F("("===r?")":"]",0),n.highlightFormatting&&(t.formatting="link-string"),t.linkHref=!0,C(t)):"error"}function F(e){return function(t,r){var i=t.next();if(i===e){r.f=r.inline=L,n.highlightFormatting&&(r.formatting="link-string");var o=C(r);return r.linkHref=!1,o}return t.match(M[e]),r.linkHref=!0,C(r)}}function E(e,t){return e.match(/^([^\]\\]|\\.)*\]:/,!1)?(t.f=q,e.next(),n.highlightFormatting&&(t.formatting="link"),t.linkText=!0,C(t)):m(e,t,L)}function q(e,t){if(e.match(/^\]:/,!0)){t.f=t.inline=A,n.highlightFormatting&&(t.formatting="link");var r=C(t);return t.linkText=!1,r}return e.match(/^([^\]\\]|\\.)+/,!0),u.linkText}function A(e,t){return e.eatSpace()?null:(e.match(/^[^\s]+/,!0),void 0===e.peek()?t.linkTitle=!0:e.match(/^(?:\s+(?:"(?:[^"\\]|\\\\|\\.)+"|'(?:[^'\\]|\\\\|\\.)+'|\((?:[^)\\]|\\\\|\\.)+\)))?/,!0),t.f=t.inline=L,u.linkHref+" url")}var r=e.getMode(t,"text/html"),i="null"==r.name;void 0===n.highlightFormatting&&(n.highlightFormatting=!1),void 0===n.maxBlockquoteDepth&&(n.maxBlockquoteDepth=0),void 0===n.underscoresBreakWords&&(n.underscoresBreakWords=!0),void 0===n.taskLists&&(n.taskLists=!1),void 0===n.strikethrough&&(n.strikethrough=!1),void 0===n.tokenTypeOverrides&&(n.tokenTypeOverrides={});var u={header:"header",code:"comment",quote:"quote",list1:"variable-2",list2:"variable-3",list3:"keyword",hr:"hr",image:"image",imageAltText:"image-alt-text",imageMarker:"image-marker",formatting:"formatting",linkInline:"link",linkEmail:"link",linkText:"link",linkHref:"string",em:"em",strong:"strong",strikethrough:"strikethrough"};for(var a in u)u.hasOwnProperty(a)&&n.tokenTypeOverrides[a]&&(u[a]=n.tokenTypeOverrides[a]);var f=/^([*\-_])(?:\s*\1){2,}\s*$/,l=/^(?:[*\-+]|^[0-9]+([.)]))\s+/,s=/^\[(x| )\](?=\s)/,c=n.allowAtxHeaderWithoutSpace?/^(#+)/:/^(#+)(?: |$)/,d=/^ *(?:\={1,}|-{1,})\s*$/,h=/^[^#!\[\]*_\\<>` "'(~]+/,p=new RegExp("^("+(n.fencedCodeBlocks===!0?"~~~+|```+":n.fencedCodeBlocks)+")[ \\t]*([\\w+#-]*)"),M={")":/^(?:[^\\\(\)]|\\.|\((?:[^\\\(\)]|\\.)*\))*?(?=\))/,"]":/^(?:[^\\\[\]]|\\.|\[(?:[^\\\[\\]]|\\.)*\])*?(?=\])/},O={startState:function(){return{f:b,prevLine:null,thisLine:null,block:b,htmlState:null,indentation:0,inline:L,text:S,formatting:!1,linkText:!1,linkHref:!1,linkTitle:!1,code:0,em:!1,strong:!1,header:0,hr:!1,taskList:!1,list:!1,listStack:[],quote:0,trailingSpace:0,trailingSpaceNewLine:!1,strikethrough:!1,fencedChars:null}},copyState:function(t){return{f:t.f,prevLine:t.prevLine,thisLine:t.thisLine,block:t.block,htmlState:t.htmlState&&e.copyState(r,t.htmlState),indentation:t.indentation,localMode:t.localMode,localState:t.localMode?e.copyState(t.localMode,t.localState):null,inline:t.inline,text:t.text,formatting:!1,linkTitle:t.linkTitle,code:t.code,em:t.em,strong:t.strong,strikethrough:t.strikethrough,header:t.header,hr:t.hr,taskList:t.taskList,list:t.list,listStack:t.listStack.slice(0),quote:t.quote,indentedCode:t.indentedCode,trailingSpace:t.trailingSpace,trailingSpaceNewLine:t.trailingSpaceNewLine,md_inside:t.md_inside,fencedChars:t.fencedChars}},token:function(e,t){if(t.formatting=!1,e!=t.thisLine){var n=t.header||t.hr;if(t.header=0,t.hr=!1,e.match(/^\s*$/,!0)||n){if(y(t),!n)return null;t.prevLine=null}t.prevLine=t.thisLine,t.thisLine=e,t.taskList=!1,t.trailingSpace=0,t.trailingSpaceNewLine=!1,t.f=t.block;var r=e.match(/^\s*/,!0)[0].replace(/\t/g,"    ").length;if(t.indentationDiff=Math.min(r-t.indentation,4),t.indentation=t.indentation+t.indentationDiff,r>0)return null}return t.f(e,t)},innerMode:function(e){return e.block==k?{state:e.htmlState,mode:r}:e.localState?{state:e.localState,mode:e.localMode}:{state:e,mode:O}},blankLine:y,getType:C,closeBrackets:"()[]{}''\"\"``",fold:"markdown"};return O},"xml"),e.defineMIME("text/x-markdown","markdown")}),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){"use strict";var t=/^(\s*)(>[> ]*|- \[[x ]\]\s|[*+-]\s|(\d+)([.)]))(\s*)/,n=/^(\s*)(>[> ]*|- \[[x ]\]|[*+-]|(\d+)[.)])(\s*)$/,r=/[*+-]\s/;e.commands.newlineAndIndentContinueMarkdownList=function(i){if(i.getOption("disableInput"))return e.Pass;for(var o=i.listSelections(),u=[],a=0;a<o.length;a++){var f=o[a].head,l=i.getStateAfter(f.line),s=l.list!==!1,c=0!==l.quote,d=i.getLine(f.line),h=t.exec(d);if(!o[a].empty()||!s&&!c||!h)return void i.execCommand("newlineAndIndent");if(n.test(d))i.replaceRange("",{line:f.line,ch:0},{line:f.line,ch:f.ch+1}),u[a]="\n";else{var p=h[1],m=h[5],g=r.test(h[2])||h[2].indexOf(">")>=0?h[2].replace("x"," "):parseInt(h[3],10)+1+h[4];u[a]="\n"+p+g+m}}i.replaceSelections(u)}}),function(e,t,n){if(!e.is.x(e.Form.editor["form.main"].content)){var r=e.Form.editor["form.main"].content;r.setOption("mode","text/x-markdown"),r.addKeyMap({Enter:"newlineAndIndentContinueMarkdownList"})}}(Panel,window,document);