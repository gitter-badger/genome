!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror"),require("../xml/xml"),require("../meta")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../xml/xml","../meta"],e):e(CodeMirror)}(function(e){"use strict";e.defineMode("markdown",function(t,n){function o(n){if(e.findModeByName){var r=e.findModeByName(n);r&&(n=r.mime||r.mimes[0])}var i=e.getMode(t,n);return"null"==i.name?null:i}function g(e,t,n){return t.f=t.inline=n,n(e,t)}function m(e,t,n){return t.f=t.block=n,n(e,t)}function y(e){return!e||!/\S/.test(e.string)}function v(e){return e.linkTitle=!1,e.em=!1,e.strong=!1,e.strikethrough=!1,e.quote=0,e.indentedCode=!1,i&&e.f==b&&(e.f=E,e.block=w),e.trailingSpace=0,e.trailingSpaceNewLine=!1,e.prevLine=e.thisLine,e.thisLine=null,null}function w(t,r){var i=t.sol(),a=r.list!==!1,d=r.indentedCode;r.indentedCode=!1,a&&(r.indentationDiff>=0?(r.indentationDiff<4&&(r.indentation-=r.indentationDiff),r.list=null):r.indentation>0?r.list=null:r.list=!1);var m=null;if(r.indentationDiff>=4)return t.skipToEnd(),d||y(r.prevLine)?(r.indentation-=4,r.indentedCode=!0,u.code):null;if(t.eatSpace())return null;if((m=t.match(f))&&m[1].length<=6)return r.header=m[1].length,n.highlightFormatting&&(r.formatting="header"),r.f=r.inline,T(r);if(!(y(r.prevLine)||r.quote||a||d)&&(m=t.match(p)))return r.header="="==m[0].charAt(0)?1:2,n.highlightFormatting&&(r.formatting="header"),r.f=r.inline,T(r);if(t.eat(">"))return r.quote=i?1:r.quote+1,n.highlightFormatting&&(r.formatting="quote"),t.eatSpace(),T(r);if("["===t.peek())return g(t,r,N);if(t.match(s,!0))return r.hr=!0,u.hr;if(m=t.match(c)){var v=m[1]?"ol":"ul";for(r.indentation=t.column()+t.current().length,r.list=!0;r.listStack&&t.column()<r.listStack[r.listStack.length-1];)r.listStack.pop();return r.listStack.push(r.indentation),n.taskLists&&t.match(l,!1)&&(r.taskList=!0),r.f=r.inline,n.highlightFormatting&&(r.formatting=["list","list-"+v]),T(r)}return n.fencedCodeBlocks&&(m=t.match(h,!0))?(r.fencedChars=m[1],r.localMode=o(m[2]),r.localMode&&(r.localState=e.startState(r.localMode)),r.f=r.block=x,n.highlightFormatting&&(r.formatting="code-block"),r.code=-1,T(r)):g(t,r,r.inline)}function b(t,n){var o=r.token(t,n.htmlState);if(!i){var u=e.innerMode(r,n.htmlState);("xml"==u.mode.name&&null===u.state.tagStart&&!u.state.context&&u.state.tokenize.isInText||n.md_inside&&t.current().indexOf(">")>-1)&&(n.f=E,n.block=w,n.htmlState=null)}return o}function x(e,t){return t.fencedChars&&e.match(t.fencedChars,!1)?(t.localMode=t.localState=null,t.f=t.block=k,null):t.localMode?t.localMode.token(e,t.localState):(e.skipToEnd(),u.code)}function k(e,t){e.match(t.fencedChars),t.block=w,t.f=E,t.fencedChars=null,n.highlightFormatting&&(t.formatting="code-block"),t.code=1;var r=T(t);return t.code=0,r}function T(e){var t=[];if(e.formatting){t.push(u.formatting),"string"==typeof e.formatting&&(e.formatting=[e.formatting]);for(var r=0;r<e.formatting.length;r++)t.push(u.formatting+"-"+e.formatting[r]),"header"===e.formatting[r]&&t.push(u.formatting+"-"+e.formatting[r]+"-"+e.header),"quote"===e.formatting[r]&&(!n.maxBlockquoteDepth||n.maxBlockquoteDepth>=e.quote?t.push(u.formatting+"-"+e.formatting[r]+"-"+e.quote):t.push("error"))}if(e.taskOpen)return t.push("meta"),t.length?t.join(" "):null;if(e.taskClosed)return t.push("property"),t.length?t.join(" "):null;if(e.linkHref?t.push(u.linkHref,"url"):(e.strong&&t.push(u.strong),e.em&&t.push(u.em),e.strikethrough&&t.push(u.strikethrough),e.linkText&&t.push(u.linkText),e.code&&t.push(u.code),e.image&&t.push(u.image),e.imageAltText&&t.push(u.imageAltText,"link"),e.imageMarker&&t.push(u.imageMarker)),e.header&&t.push(u.header,u.header+"-"+e.header),e.quote&&(t.push(u.quote),!n.maxBlockquoteDepth||n.maxBlockquoteDepth>=e.quote?t.push(u.quote+"-"+e.quote):t.push(u.quote+"-"+n.maxBlockquoteDepth)),e.list!==!1){var i=(e.listStack.length-1)%3;i?1===i?t.push(u.list2):t.push(u.list3):t.push(u.list1)}return e.trailingSpaceNewLine?t.push("trailing-space-new-line"):e.trailingSpace&&t.push("trailing-space-"+(e.trailingSpace%2?"a":"b")),t.length?t.join(" "):null}function C(e,t){return e.match(d,!0)?T(t):void 0}function E(t,i){var o=i.text(t,i);if("undefined"!=typeof o)return o;if(i.list)return i.list=null,T(i);if(i.taskList){var a="x"!==t.match(l,!0)[1];return a?i.taskOpen=!0:i.taskClosed=!0,n.highlightFormatting&&(i.formatting="task"),i.taskList=!1,T(i)}if(i.taskOpen=!1,i.taskClosed=!1,i.header&&t.match(/^#+$/,!0))return n.highlightFormatting&&(i.formatting="header"),T(i);var s=t.sol(),c=t.next();if(i.linkTitle){i.linkTitle=!1;var f=c;"("===c&&(f=")"),f=(f+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1");var p="^\\s*(?:[^"+f+"\\\\]+|\\\\\\\\|\\\\.)"+f;if(t.match(new RegExp(p),!0))return u.linkHref}if("`"===c){var d=i.formatting;n.highlightFormatting&&(i.formatting="code"),t.eatWhile("`");var h=t.current().length;if(0==i.code)return i.code=h,T(i);if(h==i.code){var g=T(i);return i.code=0,g}return i.formatting=d,T(i)}if(i.code)return T(i);if("\\"===c&&(t.next(),n.highlightFormatting)){var y=T(i),v=u.formatting+"-escape";return y?y+" "+v:v}if("!"===c&&t.match(/\[[^\]]*\] ?(?:\(|\[)/,!1))return i.imageMarker=!0,i.image=!0,n.highlightFormatting&&(i.formatting="image"),T(i);if("["===c&&i.imageMarker&&t.match(/[^\]]*\](\(.*?\)| ?\[.*?\])/,!1))return i.imageMarker=!1,i.imageAltText=!0,n.highlightFormatting&&(i.formatting="image"),T(i);if("]"===c&&i.imageAltText){n.highlightFormatting&&(i.formatting="image");var y=T(i);return i.imageAltText=!1,i.image=!1,i.inline=i.f=j,y}if("["===c&&t.match(/[^\]]*\](\(.*\)| ?\[.*?\])/,!1)&&!i.image)return i.linkText=!0,n.highlightFormatting&&(i.formatting="link"),T(i);if("]"===c&&i.linkText&&t.match(/\(.*?\)| ?\[.*?\]/,!1)){n.highlightFormatting&&(i.formatting="link");var y=T(i);return i.linkText=!1,i.inline=i.f=j,y}if("<"===c&&t.match(/^(https?|ftps?):\/\/(?:[^\\>]|\\.)+>/,!1)){i.f=i.inline=S,n.highlightFormatting&&(i.formatting="link");var y=T(i);return y?y+=" ":y="",y+u.linkInline}if("<"===c&&t.match(/^[^> \\]+@(?:[^\\>]|\\.)+>/,!1)){i.f=i.inline=S,n.highlightFormatting&&(i.formatting="link");var y=T(i);return y?y+=" ":y="",y+u.linkEmail}if("<"===c&&t.match(/^(!--|[a-z]+(?:\s+[a-z_:.\-]+(?:\s*=\s*[^ >]+)?)*\s*>)/i,!1)){var w=t.string.indexOf(">",t.pos);if(-1!=w){var x=t.string.substring(t.start,w);/markdown\s*=\s*('|"){0,1}1('|"){0,1}/.test(x)&&(i.md_inside=!0)}return t.backUp(1),i.htmlState=e.startState(r),m(t,i,b)}if("<"===c&&t.match(/^\/\w*?>/))return i.md_inside=!1,"tag";var k=!1;if(!n.underscoresBreakWords&&"_"===c&&"_"!==t.peek()&&t.match(/(\w)/,!1)){var C=t.pos-2;if(C>=0){var E=t.string.charAt(C);"_"!==E&&E.match(/(\w)/,!1)&&(k=!0)}}if("*"===c||"_"===c&&!k)if(s&&" "===t.peek());else{if(i.strong===c&&t.eat(c)){n.highlightFormatting&&(i.formatting="strong");var g=T(i);return i.strong=!1,g}if(!i.strong&&t.eat(c))return i.strong=c,n.highlightFormatting&&(i.formatting="strong"),T(i);if(i.em===c){n.highlightFormatting&&(i.formatting="em");var g=T(i);return i.em=!1,g}if(!i.em)return i.em=c,n.highlightFormatting&&(i.formatting="em"),T(i)}else if(" "===c&&(t.eat("*")||t.eat("_"))){if(" "===t.peek())return T(i);t.backUp(1)}if(n.strikethrough)if("~"===c&&t.eatWhile(c)){if(i.strikethrough){n.highlightFormatting&&(i.formatting="strikethrough");var g=T(i);return i.strikethrough=!1,g}if(t.match(/^[^\s]/,!1))return i.strikethrough=!0,n.highlightFormatting&&(i.formatting="strikethrough"),T(i)}else if(" "===c&&t.match(/^~~/,!0)){if(" "===t.peek())return T(i);t.backUp(2)}return" "===c&&(t.match(/ +$/,!1)?i.trailingSpace++:i.trailingSpace&&(i.trailingSpaceNewLine=!0)),T(i)}function S(e,t){var r=e.next();if(">"===r){t.f=t.inline=E,n.highlightFormatting&&(t.formatting="link");var i=T(t);return i?i+=" ":i="",i+u.linkInline}return e.match(/^[^>]+/,!0),u.linkInline}function j(e,t){if(e.eatSpace())return null;var r=e.next();return"("===r||"["===r?(t.f=t.inline=A("("===r?")":"]",0),n.highlightFormatting&&(t.formatting="link-string"),t.linkHref=!0,T(t)):"error"}function A(e){return function(t,r){var i=t.next();if(i===e){r.f=r.inline=E,n.highlightFormatting&&(r.formatting="link-string");var o=T(r);return r.linkHref=!1,o}return t.match($[e]),r.linkHref=!0,T(r)}}function N(e,t){return e.match(/^([^\]\\]|\\.)*\]:/,!1)?(t.f=F,e.next(),n.highlightFormatting&&(t.formatting="link"),t.linkText=!0,T(t)):g(e,t,E)}function F(e,t){if(e.match(/^\]:/,!0)){t.f=t.inline=L,n.highlightFormatting&&(t.formatting="link");var r=T(t);return t.linkText=!1,r}return e.match(/^([^\]\\]|\\.)+/,!0),u.linkText}function L(e,t){return e.eatSpace()?null:(e.match(/^[^\s]+/,!0),void 0===e.peek()?t.linkTitle=!0:e.match(/^(?:\s+(?:"(?:[^"\\]|\\\\|\\.)+"|'(?:[^'\\]|\\\\|\\.)+'|\((?:[^)\\]|\\\\|\\.)+\)))?/,!0),t.f=t.inline=E,u.linkHref+" url")}var r=e.getMode(t,"text/html"),i="null"==r.name;void 0===n.highlightFormatting&&(n.highlightFormatting=!1),void 0===n.maxBlockquoteDepth&&(n.maxBlockquoteDepth=0),void 0===n.underscoresBreakWords&&(n.underscoresBreakWords=!0),void 0===n.taskLists&&(n.taskLists=!1),void 0===n.strikethrough&&(n.strikethrough=!1),void 0===n.tokenTypeOverrides&&(n.tokenTypeOverrides={});var u={header:"header",code:"comment",quote:"quote",list1:"variable-2",list2:"variable-3",list3:"keyword",hr:"hr",image:"image",imageAltText:"image-alt-text",imageMarker:"image-marker",formatting:"formatting",linkInline:"link",linkEmail:"link",linkText:"link",linkHref:"string",em:"em",strong:"strong",strikethrough:"strikethrough"};for(var a in u)u.hasOwnProperty(a)&&n.tokenTypeOverrides[a]&&(u[a]=n.tokenTypeOverrides[a]);var s=/^([*\-_])(?:\s*\1){2,}\s*$/,c=/^(?:[*\-+]|^[0-9]+([.)]))\s+/,l=/^\[(x| )\](?=\s)/,f=n.allowAtxHeaderWithoutSpace?/^(#+)/:/^(#+)(?: |$)/,p=/^ *(?:\={1,}|-{1,})\s*$/,d=/^[^#!\[\]*_\\<>` "'(~]+/,h=new RegExp("^("+(n.fencedCodeBlocks===!0?"~~~+|```+":n.fencedCodeBlocks)+")[ \\t]*([\\w+#-]*)"),$={")":/^(?:[^\\\(\)]|\\.|\((?:[^\\\(\)]|\\.)*\))*?(?=\))/,"]":/^(?:[^\\\[\]]|\\.|\[(?:[^\\\[\\]]|\\.)*\])*?(?=\])/},D={startState:function(){return{f:w,prevLine:null,thisLine:null,block:w,htmlState:null,indentation:0,inline:E,text:C,formatting:!1,linkText:!1,linkHref:!1,linkTitle:!1,code:0,em:!1,strong:!1,header:0,hr:!1,taskList:!1,list:!1,listStack:[],quote:0,trailingSpace:0,trailingSpaceNewLine:!1,strikethrough:!1,fencedChars:null}},copyState:function(t){return{f:t.f,prevLine:t.prevLine,thisLine:t.thisLine,block:t.block,htmlState:t.htmlState&&e.copyState(r,t.htmlState),indentation:t.indentation,localMode:t.localMode,localState:t.localMode?e.copyState(t.localMode,t.localState):null,inline:t.inline,text:t.text,formatting:!1,linkTitle:t.linkTitle,code:t.code,em:t.em,strong:t.strong,strikethrough:t.strikethrough,header:t.header,hr:t.hr,taskList:t.taskList,list:t.list,listStack:t.listStack.slice(0),quote:t.quote,indentedCode:t.indentedCode,trailingSpace:t.trailingSpace,trailingSpaceNewLine:t.trailingSpaceNewLine,md_inside:t.md_inside,fencedChars:t.fencedChars}},token:function(e,t){if(t.formatting=!1,e!=t.thisLine){var n=t.header||t.hr;if(t.header=0,t.hr=!1,e.match(/^\s*$/,!0)||n){if(v(t),!n)return null;t.prevLine=null}t.prevLine=t.thisLine,t.thisLine=e,t.taskList=!1,t.trailingSpace=0,t.trailingSpaceNewLine=!1,t.f=t.block;var r=e.match(/^\s*/,!0)[0].replace(/\t/g,"    ").length;if(t.indentationDiff=Math.min(r-t.indentation,4),t.indentation=t.indentation+t.indentationDiff,r>0)return null}return t.f(e,t)},innerMode:function(e){return e.block==b?{state:e.htmlState,mode:r}:e.localState?{state:e.localState,mode:e.localMode}:{state:e,mode:D}},blankLine:v,getType:T,closeBrackets:"()[]{}''\"\"``",fold:"markdown"};return D},"xml"),e.defineMIME("text/x-markdown","markdown")}),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){"use strict";var t=/^(\s*)(>[> ]*|- \[[x ]\]\s|[*+-]\s|(\d+)([.)]))(\s*)/,n=/^(\s*)(>[> ]*|- \[[x ]\]|[*+-]|(\d+)[.)])(\s*)$/,r=/[*+-]\s/;e.commands.newlineAndIndentContinueMarkdownList=function(i){if(i.getOption("disableInput"))return e.Pass;for(var o=i.listSelections(),u=[],a=0;a<o.length;a++){var s=o[a].head,c=i.getStateAfter(s.line),l=c.list!==!1,f=0!==c.quote,p=i.getLine(s.line),d=t.exec(p);if(!o[a].empty()||!l&&!f||!d)return void i.execCommand("newlineAndIndent");if(n.test(p))i.replaceRange("",{line:s.line,ch:0},{line:s.line,ch:s.ch+1}),u[a]="\n";else{var h=d[1],g=d[5],m=r.test(d[2])||d[2].indexOf(">")>=0?d[2].replace("x"," "):parseInt(d[3],10)+1+d[4];u[a]="\n"+h+m+g}}i.replaceSelections(u)}}),function(e,t,n){if("undefined"!=typeof e.Form.editor["form.main"].content){var r=e.Form.editor["form.main"].content;r.setOption("mode","text/x-markdown"),r.addKeyMap({Enter:"newlineAndIndentContinueMarkdownList"})}}(Panel,window,document);