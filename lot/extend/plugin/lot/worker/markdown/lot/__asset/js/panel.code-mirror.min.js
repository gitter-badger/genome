!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror"),require("../xml/xml"),require("../meta")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../xml/xml","../meta"],e):e(CodeMirror)}(function(e){"use strict";e.defineMode("markdown",function(t,n){function a(n){if(e.findModeByName){var i=e.findModeByName(n);i&&(n=i.mime||i.mimes[0])}var r=e.getMode(t,n);return"null"==r.name?null:r}function g(e,t,n){return t.f=t.inline=n,n(e,t)}function p(e,t,n){return t.f=t.block=n,n(e,t)}function k(e){return!e||!/\S/.test(e.string)}function v(e){return e.linkTitle=!1,e.em=!1,e.strong=!1,e.strikethrough=!1,e.quote=0,e.indentedCode=!1,r&&e.f==y&&(e.f=C,e.block=x),e.trailingSpace=0,e.trailingSpaceNewLine=!1,e.prevLine=e.thisLine,e.thisLine=null,null}function x(t,i){var r=t.sol(),l=i.list!==!1,d=i.indentedCode;i.indentedCode=!1,l&&(i.indentationDiff>=0?(i.indentationDiff<4&&(i.indentation-=i.indentationDiff),i.list=null):i.indentation>0?i.list=null:i.list=!1);var p=null;if(i.indentationDiff>=4)return t.skipToEnd(),d||k(i.prevLine)?(i.indentation-=4,i.indentedCode=!0,o.code):null;if(t.eatSpace())return null;if((p=t.match(c))&&p[1].length<=6)return i.header=p[1].length,n.highlightFormatting&&(i.formatting="header"),i.f=i.inline,w(i);if(!(k(i.prevLine)||i.quote||l||d)&&(p=t.match(h)))return i.header="="==p[0].charAt(0)?1:2,n.highlightFormatting&&(i.formatting="header"),i.f=i.inline,w(i);if(t.eat(">"))return i.quote=r?1:i.quote+1,n.highlightFormatting&&(i.formatting="quote"),t.eatSpace(),w(i);if("["===t.peek())return g(t,i,_);if(t.match(f,!0))return i.hr=!0,o.hr;if(p=t.match(s)){var v=p[1]?"ol":"ul";for(i.indentation=t.column()+t.current().length,i.list=!0;i.listStack&&t.column()<i.listStack[i.listStack.length-1];)i.listStack.pop();return i.listStack.push(i.indentation),n.taskLists&&t.match(u,!1)&&(i.taskList=!0),i.f=i.inline,n.highlightFormatting&&(i.formatting=["list","list-"+v]),w(i)}return n.fencedCodeBlocks&&(p=t.match(m,!0))?(i.fencedChars=p[1],i.localMode=a(p[2]),i.localMode&&(i.localState=e.startState(i.localMode)),i.f=i.block=S,n.highlightFormatting&&(i.formatting="code-block"),i.code=-1,w(i)):g(t,i,i.inline)}function y(t,n){var a=i.token(t,n.htmlState);if(!r){var o=e.innerMode(i,n.htmlState);("xml"==o.mode.name&&null===o.state.tagStart&&!o.state.context&&o.state.tokenize.isInText||n.md_inside&&t.current().indexOf(">")>-1)&&(n.f=C,n.block=x,n.htmlState=null)}return a}function S(e,t){return t.fencedChars&&e.match(t.fencedChars,!1)?(t.localMode=t.localState=null,t.f=t.block=b,null):t.localMode?t.localMode.token(e,t.localState):(e.skipToEnd(),o.code)}function b(e,t){e.match(t.fencedChars),t.block=x,t.f=C,t.fencedChars=null,n.highlightFormatting&&(t.formatting="code-block"),t.code=1;var i=w(t);return t.code=0,i}function w(e){var t=[];if(e.formatting){t.push(o.formatting),"string"==typeof e.formatting&&(e.formatting=[e.formatting]);for(var i=0;i<e.formatting.length;i++)t.push(o.formatting+"-"+e.formatting[i]),"header"===e.formatting[i]&&t.push(o.formatting+"-"+e.formatting[i]+"-"+e.header),"quote"===e.formatting[i]&&(!n.maxBlockquoteDepth||n.maxBlockquoteDepth>=e.quote?t.push(o.formatting+"-"+e.formatting[i]+"-"+e.quote):t.push("error"))}if(e.taskOpen)return t.push("meta"),t.length?t.join(" "):null;if(e.taskClosed)return t.push("property"),t.length?t.join(" "):null;if(e.linkHref?t.push(o.linkHref,"url"):(e.strong&&t.push(o.strong),e.em&&t.push(o.em),e.strikethrough&&t.push(o.strikethrough),e.linkText&&t.push(o.linkText),e.code&&t.push(o.code),e.image&&t.push(o.image),e.imageAltText&&t.push(o.imageAltText,"link"),e.imageMarker&&t.push(o.imageMarker)),e.header&&t.push(o.header,o.header+"-"+e.header),e.quote&&(t.push(o.quote),!n.maxBlockquoteDepth||n.maxBlockquoteDepth>=e.quote?t.push(o.quote+"-"+e.quote):t.push(o.quote+"-"+n.maxBlockquoteDepth)),e.list!==!1){var r=(e.listStack.length-1)%3;r?1===r?t.push(o.list2):t.push(o.list3):t.push(o.list1)}return e.trailingSpaceNewLine?t.push("trailing-space-new-line"):e.trailingSpace&&t.push("trailing-space-"+(e.trailingSpace%2?"a":"b")),t.length?t.join(" "):null}function L(e,t){return e.match(d,!0)?w(t):void 0}function C(t,r){var a=r.text(t,r);if("undefined"!=typeof a)return a;if(r.list)return r.list=null,w(r);if(r.taskList){var l="x"!==t.match(u,!0)[1];return l?r.taskOpen=!0:r.taskClosed=!0,n.highlightFormatting&&(r.formatting="task"),r.taskList=!1,w(r)}if(r.taskOpen=!1,r.taskClosed=!1,r.header&&t.match(/^#+$/,!0))return n.highlightFormatting&&(r.formatting="header"),w(r);var f=t.sol(),s=t.next();if(r.linkTitle){r.linkTitle=!1;var c=s;"("===s&&(c=")"),c=(c+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1");var h="^\\s*(?:[^"+c+"\\\\]+|\\\\\\\\|\\\\.)"+c;if(t.match(new RegExp(h),!0))return o.linkHref}if("`"===s){var d=r.formatting;n.highlightFormatting&&(r.formatting="code"),t.eatWhile("`");var m=t.current().length;if(0==r.code)return r.code=m,w(r);if(m==r.code){var g=w(r);return r.code=0,g}return r.formatting=d,w(r)}if(r.code)return w(r);if("\\"===s&&(t.next(),n.highlightFormatting)){var k=w(r),v=o.formatting+"-escape";return k?k+" "+v:v}if("!"===s&&t.match(/\[[^\]]*\] ?(?:\(|\[)/,!1))return r.imageMarker=!0,r.image=!0,n.highlightFormatting&&(r.formatting="image"),w(r);if("["===s&&r.imageMarker&&t.match(/[^\]]*\](\(.*?\)| ?\[.*?\])/,!1))return r.imageMarker=!1,r.imageAltText=!0,n.highlightFormatting&&(r.formatting="image"),w(r);if("]"===s&&r.imageAltText){n.highlightFormatting&&(r.formatting="image");var k=w(r);return r.imageAltText=!1,r.image=!1,r.inline=r.f=M,k}if("["===s&&t.match(/[^\]]*\](\(.*\)| ?\[.*?\])/,!1)&&!r.image)return r.linkText=!0,n.highlightFormatting&&(r.formatting="link"),w(r);if("]"===s&&r.linkText&&t.match(/\(.*?\)| ?\[.*?\]/,!1)){n.highlightFormatting&&(r.formatting="link");var k=w(r);return r.linkText=!1,r.inline=r.f=M,k}if("<"===s&&t.match(/^(https?|ftps?):\/\/(?:[^\\>]|\\.)+>/,!1)){r.f=r.inline=T,n.highlightFormatting&&(r.formatting="link");var k=w(r);return k?k+=" ":k="",k+o.linkInline}if("<"===s&&t.match(/^[^> \\]+@(?:[^\\>]|\\.)+>/,!1)){r.f=r.inline=T,n.highlightFormatting&&(r.formatting="link");var k=w(r);return k?k+=" ":k="",k+o.linkEmail}if("<"===s&&t.match(/^(!--|[a-z]+(?:\s+[a-z_:.\-]+(?:\s*=\s*[^ >]+)?)*\s*>)/i,!1)){var x=t.string.indexOf(">",t.pos);if(-1!=x){var S=t.string.substring(t.start,x);/markdown\s*=\s*('|"){0,1}1('|"){0,1}/.test(S)&&(r.md_inside=!0)}return t.backUp(1),r.htmlState=e.startState(i),p(t,r,y)}if("<"===s&&t.match(/^\/\w*?>/))return r.md_inside=!1,"tag";var b=!1;if(!n.underscoresBreakWords&&"_"===s&&"_"!==t.peek()&&t.match(/(\w)/,!1)){var L=t.pos-2;if(L>=0){var C=t.string.charAt(L);"_"!==C&&C.match(/(\w)/,!1)&&(b=!0)}}if("*"===s||"_"===s&&!b)if(f&&" "===t.peek());else{if(r.strong===s&&t.eat(s)){n.highlightFormatting&&(r.formatting="strong");var g=w(r);return r.strong=!1,g}if(!r.strong&&t.eat(s))return r.strong=s,n.highlightFormatting&&(r.formatting="strong"),w(r);if(r.em===s){n.highlightFormatting&&(r.formatting="em");var g=w(r);return r.em=!1,g}if(!r.em)return r.em=s,n.highlightFormatting&&(r.formatting="em"),w(r)}else if(" "===s&&(t.eat("*")||t.eat("_"))){if(" "===t.peek())return w(r);t.backUp(1)}if(n.strikethrough)if("~"===s&&t.eatWhile(s)){if(r.strikethrough){n.highlightFormatting&&(r.formatting="strikethrough");var g=w(r);return r.strikethrough=!1,g}if(t.match(/^[^\s]/,!1))return r.strikethrough=!0,n.highlightFormatting&&(r.formatting="strikethrough"),w(r)}else if(" "===s&&t.match(/^~~/,!0)){if(" "===t.peek())return w(r);t.backUp(2)}return" "===s&&(t.match(/ +$/,!1)?r.trailingSpace++:r.trailingSpace&&(r.trailingSpaceNewLine=!0)),w(r)}function T(e,t){var i=e.next();if(">"===i){t.f=t.inline=C,n.highlightFormatting&&(t.formatting="link");var r=w(t);return r?r+=" ":r="",r+o.linkInline}return e.match(/^[^>]+/,!0),o.linkInline}function M(e,t){if(e.eatSpace())return null;var i=e.next();return"("===i||"["===i?(t.f=t.inline=q("("===i?")":"]",0),n.highlightFormatting&&(t.formatting="link-string"),t.linkHref=!0,w(t)):"error"}function q(e){return function(t,i){var r=t.next();if(r===e){i.f=i.inline=C,n.highlightFormatting&&(i.formatting="link-string");var a=w(i);return i.linkHref=!1,a}return t.match(F[e]),i.linkHref=!0,w(i)}}function _(e,t){return e.match(/^([^\]\\]|\\.)*\]:/,!1)?(t.f=A,e.next(),n.highlightFormatting&&(t.formatting="link"),t.linkText=!0,w(t)):g(e,t,C)}function A(e,t){if(e.match(/^\]:/,!0)){t.f=t.inline=O,n.highlightFormatting&&(t.formatting="link");var i=w(t);return t.linkText=!1,i}return e.match(/^([^\]\\]|\\.)+/,!0),o.linkText}function O(e,t){return e.eatSpace()?null:(e.match(/^[^\s]+/,!0),void 0===e.peek()?t.linkTitle=!0:e.match(/^(?:\s+(?:"(?:[^"\\]|\\\\|\\.)+"|'(?:[^'\\]|\\\\|\\.)+'|\((?:[^)\\]|\\\\|\\.)+\)))?/,!0),t.f=t.inline=C,o.linkHref+" url")}var i=e.getMode(t,"text/html"),r="null"==i.name;void 0===n.highlightFormatting&&(n.highlightFormatting=!1),void 0===n.maxBlockquoteDepth&&(n.maxBlockquoteDepth=0),void 0===n.underscoresBreakWords&&(n.underscoresBreakWords=!0),void 0===n.taskLists&&(n.taskLists=!1),void 0===n.strikethrough&&(n.strikethrough=!1),void 0===n.tokenTypeOverrides&&(n.tokenTypeOverrides={});var o={header:"header",code:"comment",quote:"quote",list1:"variable-2",list2:"variable-3",list3:"keyword",hr:"hr",image:"image",imageAltText:"image-alt-text",imageMarker:"image-marker",formatting:"formatting",linkInline:"link",linkEmail:"link",linkText:"link",linkHref:"string",em:"em",strong:"strong",strikethrough:"strikethrough"};for(var l in o)o.hasOwnProperty(l)&&n.tokenTypeOverrides[l]&&(o[l]=n.tokenTypeOverrides[l]);var f=/^([*\-_])(?:\s*\1){2,}\s*$/,s=/^(?:[*\-+]|^[0-9]+([.)]))\s+/,u=/^\[(x| )\](?=\s)/,c=n.allowAtxHeaderWithoutSpace?/^(#+)/:/^(#+)(?: |$)/,h=/^ *(?:\={1,}|-{1,})\s*$/,d=/^[^#!\[\]*_\\<>` "'(~]+/,m=new RegExp("^("+(n.fencedCodeBlocks===!0?"~~~+|```+":n.fencedCodeBlocks)+")[ \\t]*([\\w+#-]*)"),F={")":/^(?:[^\\\(\)]|\\.|\((?:[^\\\(\)]|\\.)*\))*?(?=\))/,"]":/^(?:[^\\\[\]]|\\.|\[(?:[^\\\[\\]]|\\.)*\])*?(?=\])/},B={startState:function(){return{f:x,prevLine:null,thisLine:null,block:x,htmlState:null,indentation:0,inline:C,text:L,formatting:!1,linkText:!1,linkHref:!1,linkTitle:!1,code:0,em:!1,strong:!1,header:0,hr:!1,taskList:!1,list:!1,listStack:[],quote:0,trailingSpace:0,trailingSpaceNewLine:!1,strikethrough:!1,fencedChars:null}},copyState:function(t){return{f:t.f,prevLine:t.prevLine,thisLine:t.thisLine,block:t.block,htmlState:t.htmlState&&e.copyState(i,t.htmlState),indentation:t.indentation,localMode:t.localMode,localState:t.localMode?e.copyState(t.localMode,t.localState):null,inline:t.inline,text:t.text,formatting:!1,linkTitle:t.linkTitle,code:t.code,em:t.em,strong:t.strong,strikethrough:t.strikethrough,header:t.header,hr:t.hr,taskList:t.taskList,list:t.list,listStack:t.listStack.slice(0),quote:t.quote,indentedCode:t.indentedCode,trailingSpace:t.trailingSpace,trailingSpaceNewLine:t.trailingSpaceNewLine,md_inside:t.md_inside,fencedChars:t.fencedChars}},token:function(e,t){if(t.formatting=!1,e!=t.thisLine){var n=t.header||t.hr;if(t.header=0,t.hr=!1,e.match(/^\s*$/,!0)||n){if(v(t),!n)return null;t.prevLine=null}t.prevLine=t.thisLine,t.thisLine=e,t.taskList=!1,t.trailingSpace=0,t.trailingSpaceNewLine=!1,t.f=t.block;var i=e.match(/^\s*/,!0)[0].replace(/\t/g,"    ").length;if(t.indentationDiff=Math.min(i-t.indentation,4),t.indentation=t.indentation+t.indentationDiff,i>0)return null}return t.f(e,t)},innerMode:function(e){return e.block==y?{state:e.htmlState,mode:i}:e.localState?{state:e.localState,mode:e.localMode}:{state:e,mode:B}},blankLine:v,getType:w,closeBrackets:"()[]{}''\"\"``",fold:"markdown"};return B},"xml"),e.defineMIME("text/x-markdown","markdown")}),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){"use strict";var t=/^(\s*)(>[> ]*|- \[[x ]\]\s|[*+-]\s|(\d+)([.)]))(\s*)/,n=/^(\s*)(>[> ]*|- \[[x ]\]|[*+-]|(\d+)[.)])(\s*)$/,i=/[*+-]\s/;e.commands.newlineAndIndentContinueMarkdownList=function(r){if(r.getOption("disableInput"))return e.Pass;for(var a=r.listSelections(),o=[],l=0;l<a.length;l++){var f=a[l].head,s=r.getStateAfter(f.line),u=s.list!==!1,c=0!==s.quote,h=r.getLine(f.line),d=t.exec(h);if(!a[l].empty()||!u&&!c||!d)return void r.execCommand("newlineAndIndent");if(n.test(h))r.replaceRange("",{line:f.line,ch:0},{line:f.line,ch:f.ch+1}),o[l]="\n";else{var m=d[1],g=d[5],p=i.test(d[2])||d[2].indexOf(">")>=0?d[2].replace("x"," "):parseInt(d[3],10)+1+d[4];o[l]="\n"+m+p+g}}r.replaceSelections(o)}}),function(e,t,n){"undefined"!=typeof e.Form.editor["form.main"].content&&"Markdown"===e.Form.lot["form.main"].type.value&&(e.Form.editor["form.main"].content.setOption("mode","text/x-markdown"),e.Form.editor["form.main"].content.setOption("extraKeys",{Enter:"newlineAndIndentContinueMarkdownList","Ctrl-B":function(e){var t=e.getSelection(),n="**"===t.slice(0,2)&&"**"===t.slice(-2);e.replaceSelection(n?t.slice(2,-2):"**"+t+"**","around")},"Ctrl-I":function(e){var t=e.getSelection(),n="_"===t.slice(0,1)&&"_"===t.slice(-1);e.replaceSelection(n?t.slice(1,-1):"_"+t+"_","around")},"Ctrl-K":function(e){var t=e.getSelection(),n="`"===t.slice(0,1)&&"`"===t.slice(-1);e.replaceSelection(n?t.slice(1,-1):"`"+t+"`","around")}}))}(Panel,window,document);